<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>ROS - FangjieYu‘s site</title><meta name=Description content="This is my cool site"><meta property="og:url" content="https://fjyu95.github.io/posts/ros-17ae4020f0608037ab9ce65eddd62e49/">
<meta property="og:site_name" content="FangjieYu‘s site"><meta property="og:title" content="ROS"><meta property="og:description" content="ROS核心概念"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-01-13T00:00:00+00:00"><meta property="article:modified_time" content="2025-04-16T00:00:00+00:00"><meta property="article:tag" content="ROS"><meta property="article:tag" content="Slam"><meta property="article:tag" content="机器人"><meta property="article:tag" content="3d"><meta name=twitter:card content="summary"><meta name=twitter:title content="ROS"><meta name=twitter:description content="ROS核心概念"><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://fjyu95.github.io/posts/ros-17ae4020f0608037ab9ce65eddd62e49/><link rel=prev href=https://fjyu95.github.io/posts/rgbd%E7%9B%B8%E6%9C%BA/><link rel=next href=https://fjyu95.github.io/posts/vrar/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"ROS","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/fjyu95.github.io\/posts\/ros-17ae4020f0608037ab9ce65eddd62e49\/"},"genre":"posts","keywords":"ROS, slam, 机器人, 3d","wordcount":4980,"url":"https:\/\/fjyu95.github.io\/posts\/ros-17ae4020f0608037ab9ce65eddd62e49\/","datePublished":"2025-01-13T00:00:00+00:00","dateModified":"2025-04-16T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"fjyu95"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="FangjieYu‘s site">fjyu95</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>posts </a><a class=menu-item href=/tags/>tags </a><a class=menu-item href=/categories/>category </a><a class=menu-item href=/about/>about </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="FangjieYu‘s site">fjyu95</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>posts</a><a class=menu-item href=/tags/ title>tags</a><a class=menu-item href=/categories/ title>category</a><a class=menu-item href=/about/ title>about</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">ROS</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://fjyu95.github.io/ title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>fjyu95</a></span>&nbsp;<span class=post-category>included in <a href=/categories/3d/><i class="far fa-folder fa-fw" aria-hidden=true></i>3d</a>&nbsp;<a href=/categories/slam/><i class="far fa-folder fa-fw" aria-hidden=true></i>Slam</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2025-01-13>2025-01-13</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;4980 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;10 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#教程文档>教程文档</a></li><li><a href=#安装>安装</a></li><li><a href=#核心概念>核心概念</a><ul><li><a href=#1-节点nodes>1. <strong>节点（Nodes）</strong></a></li><li><a href=#2-消息messages>2. <strong>消息（Messages）</strong></a></li><li><a href=#3-主题topics>3. <strong>主题（Topics）</strong></a></li><li><a href=#4-通信机制>4. <strong>通信机制</strong></a></li></ul></li><li><a href=#ros本质>ROS本质</a><ul><li><a href=#1-分布式架构>1. <strong>分布式架构</strong></a></li><li><a href=#2-消息传递机制publishsubscribe>2. <strong>消息传递机制（Publish/Subscribe）</strong></a></li><li><a href=#3-服务与客户端serviceclient>3. <strong>服务与客户端（Service/Client）</strong></a></li><li><a href=#4-参数服务器>4. <strong>参数服务器</strong></a></li><li><a href=#5-工具与库的支持>5. <strong>工具与库的支持</strong></a></li><li><a href=#6-包管理与模块化>6. <strong>包管理与模块化</strong></a></li><li><a href=#7-硬件抽象与驱动>7. <strong>硬件抽象与驱动</strong></a></li><li><a href=#8-实时性和性能>8. <strong>实时性和性能</strong></a><ul><li><a href=#总结ros-的本质是-分布式模块化灵活的通信机制使得开发者可以快速创建复杂的机器人系统它通过话题服务参数服务器等机制将机器人软件系统拆分为多个独立的节点和功能模块通过网络进行协作和通信ros-提供了一个高效的开发框架适应不同规模的机器人应用需求>总结：<strong>ROS 的本质是 分布式、模块化、灵活的通信机制</strong>，使得开发者可以快速创建复杂的机器人系统。它通过话题、服务、参数服务器等机制，将机器人软件系统拆分为多个独立的节点和功能模块，通过网络进行协作和通信。ROS 提供了一个高效的开发框架，适应不同规模的机器人应用需求。</a></li></ul></li></ul></li><li><a href=#vs设计模式中-发布-订阅者模式>vs.设计模式中 发布-订阅者模式</a><ul><li><a href=#1-联系><strong>1. 联系</strong></a></li><li><a href=#2-区别><strong>2. 区别</strong></a></li><li><a href=#3-具体示例><strong>3. 具体示例</strong></a><ul><li><a href=#ros-发布-订阅模型><strong>ROS 发布-订阅模型</strong></a></li><li><a href=#设计模式中的发布-订阅模式><strong>设计模式中的发布-订阅模式</strong></a></li></ul></li><li><a href=#4-总结><strong>4. 总结</strong></a></li></ul></li><li><a href=#时间同步>时间同步</a><ul><li><a href=#多相机时间同步的挑战>多相机时间同步的挑战</a></li><li><a href=#ros-2-中多相机时间同步的几种方法>ROS 2 中多相机时间同步的几种方法</a></li><li><a href=#注意事项>注意事项</a></li></ul></li></ul></nav></div></div><div class=content id=content><h1 id=教程文档>教程文档</h1><p><a href=https://fishros.com/d2lros2/#/ target=_blank rel="noopener noreffer">https://fishros.com/d2lros2/#/</a></p><p><a href=https://www.ncnynl.com/archives/201801/2251.html target=_blank rel="noopener noreffer">https://www.ncnynl.com/archives/201801/2251.html</a></p><p><a href=https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/2_%E6%A6%82%E5%BF%B5%E6%80%BB%E8%A7%88/ target=_blank rel="noopener noreffer">https://book.guyuehome.com/ROS2/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/2_%E6%A6%82%E5%BF%B5%E6%80%BB%E8%A7%88/</a></p><p><a href=https://fishros.org/doc/ros2/humble/Concepts/Basic.html# target=_blank rel="noopener noreffer">https://fishros.org/doc/ros2/humble/Concepts/Basic.html#</a></p><p><a href=https://daobook.github.io/ros2-docs/xin/Tutorials/Understanding-ROS2-Nodes.html target=_blank rel="noopener noreffer">https://daobook.github.io/ros2-docs/xin/Tutorials/Understanding-ROS2-Nodes.html</a></p><h1 id=安装>安装</h1><p><a href=https://blog.csdn.net/m0_64346597/article/details/126526791 target=_blank rel="noopener noreffer">https://blog.csdn.net/m0_64346597/article/details/126526791</a></p><p><a href=https://d2lros2foxy.fishros.com/#/humble/chapt1/get_started/3.%E5%8A%A8%E6%89%8B%E5%AE%89%E8%A3%85ROS2 target=_blank rel="noopener noreffer">https://d2lros2foxy.fishros.com/#/humble/chapt1/get_started/3.%E5%8A%A8%E6%89%8B%E5%AE%89%E8%A3%85ROS2</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wget http://fishros.com/install -O fishros <span class=o>&amp;&amp;</span> . fishros
</span></span><span class=line><span class=cl><span class=c1># 有代理时不一定要换源，出现error后先n后y经测试可以安装成功</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>printenv <span class=p>|</span> grep -i ROS
</span></span><span class=line><span class=cl>ros2 run demo_nodes_cpp talker
</span></span><span class=line><span class=cl>ros2 run demo_nodes_py listener
</span></span><span class=line><span class=cl>ros2 topic list
</span></span></code></pre></td></tr></table></div></div><h1 id=核心概念>核心概念</h1><p>在ROS 2（Robot Operating System 2）中，<strong>节点（Nodes）</strong>、<strong>消息（Messages）</strong> 和 <strong>主题（Topics）</strong> 是核心概念，它们共同构成了ROS 2的通信机制。理解这些概念对于开发和调试ROS 2系统至关重要。</p><h2 id=1-节点nodes>1. <strong>节点（Nodes）</strong></h2><ul><li><strong>定义</strong>：节点是ROS 2中的基本执行单元，负责执行特定的任务。节点可以发布（publish）消息、订阅（subscribe）消息，或者两者兼而有之。</li><li><strong>作用</strong>：节点是ROS 2系统中的工作单元，可以是传感器驱动、算法处理、用户界面等。</li><li><strong>创建</strong>：节点可以通过多种编程语言创建，如C++、Python等。每个节点都是一个独立的进程，可以在不同的计算资源上运行。</li><li><strong>生命周期</strong>：节点的生命周期由ROS 2的节点管理器（如<code>rclcpp</code>或<code>rclpy</code>库）管理，包括创建、运行和销毁。</li></ul><h2 id=2-消息messages>2. <strong>消息（Messages）</strong></h2><ul><li><strong>定义</strong>：消息是节点之间通信的数据结构。ROS 2中的消息定义了数据的类型和结构。</li><li><strong>作用</strong>：消息用于在节点之间传输数据，如传感器数据、控制命令、状态信息等。</li><li><strong>定义方式</strong>：消息通常定义在<code>.msg</code>文件中，位于ROS包的<code>msg</code>目录下。消息类型可以是基本数据类型（如<code>int32</code>、<code>string</code>）或复杂数据结构（如数组、嵌套消息）。</li><li><strong>序列化</strong>：ROS 2自动处理消息的序列化和反序列化，使得不同语言编写的节点可以相互通信。</li></ul><h2 id=3-主题topics>3. <strong>主题（Topics）</strong></h2><ul><li><strong>定义</strong>：主题是消息的传输通道，类似于发布-订阅模式中的“频道”。节点可以通过主题发布消息或订阅消息。</li><li><strong>作用</strong>：主题用于解耦发布消息的节点和接收消息的节点，使得它们无需直接通信。</li><li><strong>发布与订阅</strong>：节点可以通过主题发布消息（发布者），其他节点可以订阅该主题来接收消息（订阅者）。</li><li><strong>无连接</strong>：主题是无连接的，发布者和订阅者之间没有直接的联系，消息的传输是异步的。</li></ul><h2 id=4-通信机制>4. <strong>通信机制</strong></h2><ul><li><strong>发布者（Publisher）</strong>：发布者节点负责发布消息到特定的主题。</li><li><strong>订阅者（Subscriber）</strong>：订阅者节点负责从特定的主题接收消息。</li><li><strong>QoS设置</strong>：Quality of Service (QoS) 设置决定了消息的可靠性、持久性等特性。QoS设置包括历史策略、深度、可靠性等。</li><li><strong>图形化工具</strong>：ROS 2提供了图形化工具（如<code>rqt_graph</code>）来可视化节点和主题之间的关系，帮助理解系统的通信结构。</li></ul><h1 id=ros本质>ROS本质</h1><p><strong>ROS（Robot Operating System）</strong> 是一个开源的机器人操作系统，它的核心机制和本质可以从以下几个方面来理解：</p><h2 id=1-分布式架构>1. <strong>分布式架构</strong></h2><ul><li><strong>ROS 是一个分布式系统</strong>，它支持将不同的机器人系统或计算节点分布在多个计算机或设备上，进行协作工作。</li><li>每个节点都是一个独立的进程，节点之间通过网络进行通信，能够灵活分配计算任务。</li><li><strong>Master</strong>：ROS 系统的中央协调点，负责管理节点间的连接和信息交换。它充当一个“目录服务”，帮助各个节点发现彼此。</li></ul><h2 id=2-消息传递机制publishsubscribe>2. <strong>消息传递机制（Publish/Subscribe）</strong></h2><ul><li><strong>Topic（话题）</strong>：是 ROS 中消息传递的基础单元。节点通过话题进行消息的发布和订阅。<ul><li><strong>Publisher</strong>（发布者）：发布消息到某个话题。</li><li><strong>Subscriber</strong>（订阅者）：接收某个话题的消息。</li></ul></li><li><strong>Message</strong>（消息）：通过话题传递的数据结构，通常是一个自定义的消息类型，包含了机器人操作所需的信息。</li><li>这种机制使得系统可以轻松地进行异步通信，并且支持多对多的通信模式。</li></ul><h2 id=3-服务与客户端serviceclient>3. <strong>服务与客户端（Service/Client）</strong></h2><ul><li>除了话题机制外，ROS 还支持基于请求-响应的 <strong>服务机制</strong>：<ul><li><strong>Service Server</strong>：提供服务的节点，处理请求并返回响应。</li><li><strong>Service Client</strong>：向服务节点发送请求，等待并接收响应。</li></ul></li><li>这对于那些需要同步通信的操作（如机器人控制）特别有用。</li></ul><h2 id=4-参数服务器>4. <strong>参数服务器</strong></h2><ul><li><strong>参数服务器</strong>：是一个存储和共享配置信息的中央位置。节点可以通过参数服务器存取全局的参数（例如机器人的配置参数），这些参数可以是任何数据类型，如整数、浮动点数、布尔值、字符串等。</li><li>这种机制使得节点可以动态地获取和修改配置信息。</li></ul><h2 id=5-工具与库的支持>5. <strong>工具与库的支持</strong></h2><ul><li>ROS 提供了大量的工具和库来简化开发过程，包括：<ul><li><strong>rqt</strong>：一个集成的图形化用户界面，用于调试、监控和控制机器人。</li><li><strong>rviz</strong>：3D 可视化工具，用于显示传感器数据和机器人的状态。</li><li><strong>rosbag</strong>：记录和回放消息的工具，常用于数据的采集和调试。</li></ul></li></ul><h2 id=6-包管理与模块化>6. <strong>包管理与模块化</strong></h2><ul><li>ROS 中的功能模块（节点、库、工具等）通常被组织成一个个的 <strong>包（Package）</strong>。每个包有一个特定的功能，用户可以在 ROS 工作空间中创建、构建和管理这些包。</li><li><strong>模块化</strong>的设计使得开发者可以在 ROS 生态中轻松地复用其他人的功能组件，快速构建自己的系统。</li></ul><h2 id=7-硬件抽象与驱动>7. <strong>硬件抽象与驱动</strong></h2><ul><li>ROS 提供了硬件抽象层，允许开发者在不关心硬件细节的情况下编写软件。通过 <strong>硬件驱动程序</strong>，ROS 能够与各种硬件（如传感器、执行器等）进行通信。</li><li>例如，<code>rosserial</code> 用于通过串口与微控制器通信，<code>ros_control</code> 提供了机器人控制的框架。</li></ul><h2 id=8-实时性和性能>8. <strong>实时性和性能</strong></h2><ul><li>虽然 ROS 的核心本身并不具备硬实时性，但它通过设计 <strong>实时操作系统（RTOS）</strong> 或特定的硬件加速技术可以与实时系统集成。用户可以使用 ROS 的 <strong>实时扩展</strong> 来提高系统的响应速度和性能。</li></ul><hr><h3 id=总结ros-的本质是-分布式模块化灵活的通信机制使得开发者可以快速创建复杂的机器人系统它通过话题服务参数服务器等机制将机器人软件系统拆分为多个独立的节点和功能模块通过网络进行协作和通信ros-提供了一个高效的开发框架适应不同规模的机器人应用需求>总结：<strong>ROS 的本质是 分布式、模块化、灵活的通信机制</strong>，使得开发者可以快速创建复杂的机器人系统。它通过话题、服务、参数服务器等机制，将机器人软件系统拆分为多个独立的节点和功能模块，通过网络进行协作和通信。ROS 提供了一个高效的开发框架，适应不同规模的机器人应用需求。</h3><h1 id=vs设计模式中-发布-订阅者模式>vs.设计模式中 发布-订阅者模式</h1><p>ROS 的发布-订阅模型与设计模式中的发布-订阅模式有相似之处，但也有显著的区别。以下是它们的联系与区别：</p><hr><h2 id=1-联系><strong>1. 联系</strong></h2><ul><li><strong>核心思想一致</strong>：两者都基于发布-订阅（Publish-Subscribe）模式，旨在解耦消息的发送者（发布者）和接收者（订阅者）。</li><li><strong>异步通信</strong>：发布者和订阅者之间是异步的，发布者不需要知道订阅者的存在，订阅者也不需要知道发布者的具体实现。</li><li><strong>消息传递机制</strong>：两者都通过某种形式的“通道”（在 ROS 中称为主题，在设计模式中可能称为事件总线或消息队列）来传递消息。</li></ul><hr><h2 id=2-区别><strong>2. 区别</strong></h2><table><thead><tr><th><strong>特性</strong></th><th><strong>ROS 发布-订阅模型</strong></th><th><strong>设计模式中的发布-订阅模式</strong></th></tr></thead><tbody><tr><td><strong>应用场景</strong></td><td>专为机器人系统设计，用于节点间的通信（如传感器数据、控制命令等）。</td><td>通用软件设计模式，适用于任何需要解耦消息发送和接收的场景。</td></tr><tr><td><strong>实现方式</strong></td><td>基于 ROS 框架，使用主题（Topics）作为消息传递的通道。</td><td>不依赖特定框架，可以通过事件总线、消息队列或自定义实现。</td></tr><tr><td><strong>消息类型</strong></td><td>使用 ROS 消息（Messages），支持复杂的数据结构（如传感器数据、图像等）。</td><td>消息类型由开发者定义，可以是简单的字符串、对象或自定义数据结构。</td></tr><tr><td><strong>通信机制</strong></td><td>基于 ROS 中间件（如 DDS），支持 QoS（服务质量）配置，确保消息的可靠性和实时性。</td><td>通常不提供 QoS 等高级功能，通信机制由开发者实现。</td></tr><tr><td><strong>工具支持</strong></td><td>提供丰富的工具（如 <code>rqt_graph</code>、<code>ros2 topic</code>）来监控和调试通信。</td><td>无特定工具支持，调试和监控需要开发者自行实现。</td></tr><tr><td><strong>节点管理</strong></td><td>节点由 ROS 管理，支持动态启动和停止，节点间通信由 ROS Master 或 DDS 协调。</td><td>无节点管理机制，发布者和订阅者的生命周期由开发者控制。</td></tr><tr><td><strong>扩展性</strong></td><td>支持分布式系统，可以在多台机器上运行节点，ROS 自动处理网络通信。</td><td>通常用于单机或简单的分布式系统，扩展性由开发者实现。</td></tr><tr><td><strong>标准化</strong></td><td>遵循 ROS 的标准化消息格式和通信协议。</td><td>无标准化要求，消息格式和通信协议由开发者定义。</td></tr></tbody></table><hr><h2 id=3-具体示例><strong>3. 具体示例</strong></h2><h3 id=ros-发布-订阅模型><strong>ROS 发布-订阅模型</strong></h3><ul><li><strong>发布者</strong>：一个节点发布传感器数据到 <code>/sensor_data</code> 主题。</li><li><strong>订阅者</strong>：另一个节点订阅 <code>/sensor_data</code> 主题并处理数据。</li><li><strong>工具支持</strong>：可以使用 <code>ros2 topic list</code> 查看所有主题，使用 <code>ros2 topic echo</code> 查看消息内容。</li></ul><h3 id=设计模式中的发布-订阅模式><strong>设计模式中的发布-订阅模式</strong></h3><ul><li><strong>发布者</strong>：一个对象发布事件到事件总线。</li><li><strong>订阅者</strong>：另一个对象订阅事件总线并处理事件。</li><li><strong>实现方式</strong>：可以使用观察者模式（Observer Pattern）或事件总线（Event Bus）实现。</li></ul><hr><h2 id=4-总结><strong>4. 总结</strong></h2><ul><li><strong>联系</strong>：两者都基于发布-订阅模式，核心思想是解耦消息的发送者和接收者。</li><li><strong>区别</strong>：<ul><li>ROS 的发布-订阅模型是专为机器人系统设计的，具有丰富的工具支持和标准化消息格式。</li><li>设计模式中的发布-订阅模式是通用的，适用于各种软件场景，但需要开发者自行实现通信机制和工具支持。</li></ul></li></ul><p>如果你正在开发机器人系统，ROS 的发布-订阅模型是更合适的选择；<br>如果你在开发其他类型的软件，设计模式中的发布-订阅模式可能更灵活。</p><h1 id=时间同步>时间同步</h1><p>在 <strong>ROS 2</strong> 中，多相机时间同步是一个关键问题，尤其在涉及到多台摄像机的数据融合或多视图三维重建时。<br>摄像头的图像流通常是异步的，因此需要一种方法来确保所有摄像头的图像和数据能够在相同的时间基准上同步，以便进行正确的融合和处理。</p><h2 id=多相机时间同步的挑战>多相机时间同步的挑战</h2><ul><li><strong>硬件不同步</strong>：不同的摄像头和传感器的内部时钟可能会有微小的偏差，导致它们拍摄图像的时间不一致。</li><li><strong>延迟</strong>：传感器数据的采集和传输过程中可能存在延迟，这需要通过一些方法来补偿或同步。</li></ul><h2 id=ros-2-中多相机时间同步的几种方法>ROS 2 中多相机时间同步的几种方法</h2><ol><li><p><strong>基于硬件的时间同步</strong></p><ul><li><strong>外部硬件触发</strong>：一种常见的同步方法是通过外部硬件触发信号来启动多个相机的图像采集。比如使用一个 <strong>同步信号</strong>（比如脉冲信号或网络时间协议NTP）来触发所有摄像头的快门。</li><li>在这种情况下，各摄像头都能基于这个触发信号在相同时间点拍摄图像，确保图像时间一致性。</li></ul></li><li><p><strong>基于软件的时间同步</strong></p><ul><li>当硬件同步不可行时，可以通过 <strong>ROS 2</strong> 中的软件方法来同步多个摄像头。常见的做法是通过时间戳来对齐不同相机的数据流。</li></ul><p>以下是常见的时间同步方法：</p><ul><li><strong>Time Synchronizer</strong>：ROS 2 提供了 <code>message_filters</code> 库来处理多相机或多传感器的时间同步问题。<code>message_filters</code> 提供了 <code>ApproximateTimeSynchronizer</code> 和 <code>TimeSynchronizer</code>，可以用于不同话题的同步。<ul><li><code>ApproximateTimeSynchronizer</code>：它根据时间戳的接近程度进行同步，适用于数据到达时间稍有不同的情况。</li><li><code>TimeSynchronizer</code>：要求各个消息的时间戳严格一致，因此要求消息时间戳精确对齐。</li></ul></li></ul></li><li><p><strong>时间戳对齐和补偿</strong></p><ul><li>即使通过硬件或软件同步，两个相机的图像时间戳也可能略有不同。可以通过对不同时间戳的图像进行插值或时序补偿来实现数据对齐。例如，可以通过插值算法（如线性插值或基于深度学习的预测模型）来补偿时间上的差异。</li><li>一些方法会将图像数据与相机的时间戳对比，并通过推算补偿其他相机数据的时间误差。</li></ul></li><li><p><strong>使用 NTP 或 GPS 进行全局时间同步</strong></p><ul><li>在多个传感器之间需要高精度时间同步时，可以使用 <strong>网络时间协议（NTP）</strong> 或 <strong>GPS</strong> 信号来统一时间基准。</li><li><strong>NTP</strong> 可以帮助ROS 2 中的节点通过网络同步系统时间，从而保证各个传感器使用统一的时间戳。</li><li><strong>GPS</strong> 信号可以为多个相机提供全局同步，尤其适用于移动机器人或自动驾驶汽车等应用场景，能够通过 GPS 时间来对相机数据进行全局同步。</li></ul></li><li><p><strong>考虑相机驱动的时间戳</strong></p><ul><li>一些相机驱动程序会在硬件层面提供时间戳。比如 <strong>USB 摄像头</strong> 和 <strong>工业相机</strong>，它们通常提供图像的采集时间戳。可以在 ROS 2 中直接获取这些时间戳，并通过 <strong><code>ApproximateTimeSynchronizer</code></strong> 或 <strong><code>TimeSynchronizer</code></strong> 来同步不同相机的数据。</li></ul></li></ol><h2 id=注意事项>注意事项</h2><ul><li><strong>网络延迟</strong>：如果多个摄像头数据通过网络传输，网络延迟可能会导致时间戳的不同步。需要考虑网络带宽和延迟对同步精度的影响。</li><li><strong>实时性</strong>：在实时应用中，保证时间同步的精度是至关重要的，尤其是涉及自动驾驶或实时三维建模等场景时。</li><li><strong>时间戳精度</strong>：要确保相机驱动或数据发布者提供精确的时间戳，最好使用硬件时钟来同步，而不是仅仅依赖软件计时。</li></ul><p><code>TimeSynchronizer</code> 要求被同步的消息在同一时刻具有相同的时间戳，或者至少在允许的误差范围内一致。如果时间戳对不上，<code>TimeSynchronizer</code> 不会触发回调。</p><ul><li><code>TimeSynchronizer</code> 要求所有的消息时间戳必须严格一致，否则它不会触发回调函数。如果你对时间戳有一定的容忍度，可以使用 <code>ApproximateTimeSynchronizer</code>，它会在时间戳差异较小时仍然触发回调。</li><li>如果你有多个传感器或摄像头，确保它们的时间戳是有意义的。理想情况下，时间戳应从硬件层面获得，而不是依赖系统时钟。</li></ul><p><del>ros2 bag record 会默认时间同步</del></p><p><code>ros2 bag record</code> 本身并不会自动对多相机的数据进行时间同步。它的作用是将指定话题的数据记录到 <code>.bag</code> 文件中，但它不负责处理多个相机数据的时间同步。</p><ul><li><strong>发布时同步</strong>：在发布数据时，ROS2 本身没有机制去同步多个设备（相机）的数据，你必须通过 <strong>硬件触发</strong> 或者 <strong>外部同步协议</strong> 来保证数据的同步。</li><li><strong>订阅时同步</strong>：<code>message_filters</code> 提供了基于时间戳的 <strong>软件同步</strong>，它在数据被订阅之后对消息进行同步处理，确保消息在时间上对齐。</li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2025-04-16</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://fjyu95.github.io/posts/ros-17ae4020f0608037ab9ce65eddd62e49/ data-title=ROS data-hashtags=ROS,slam,机器人,3d><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://fjyu95.github.io/posts/ros-17ae4020f0608037ab9ce65eddd62e49/ data-hashtag=ROS><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://fjyu95.github.io/posts/ros-17ae4020f0608037ab9ce65eddd62e49/ data-title=ROS><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://fjyu95.github.io/posts/ros-17ae4020f0608037ab9ce65eddd62e49/ data-title=ROS><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://fjyu95.github.io/posts/ros-17ae4020f0608037ab9ce65eddd62e49/ data-title=ROS><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/ros/>ROS</a>,&nbsp;<a href=/tags/slam/>Slam</a>,&nbsp;<a href=/tags/%E6%9C%BA%E5%99%A8%E4%BA%BA/>机器人</a>,&nbsp;<a href=/tags/3d/>3d</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/rgbd%E7%9B%B8%E6%9C%BA/ class=prev rel=prev title=RGB-D相机基本原理><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>RGB-D相机基本原理</a>
<a href=/posts/vrar/ class=next rel=next title=VR/AR>VR/AR<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.145.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.3.0"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2020 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://fjyu95.github.io/ target=_blank>fjyu95</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>