<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>docker - FangjieYuâ€˜s site</title><meta name=Description content="This is my cool site"><meta property="og:url" content="https://fjyu95.github.io/posts/docker-199e4020f06080f09e9cd8f239bcf9e7/">
<meta property="og:site_name" content="FangjieYuâ€˜s site"><meta property="og:title" content="docker"><meta property="og:description" content='dockerfile
https://www.runoob.com/docker/docker-image-usage.html
https://hub.docker.com/
# æŸ¥çœ‹dockerç‰ˆæœ¬ docker --version docker -v docker info | grep "Storage Driver" # å½“å‰ä½¿ç”¨çš„å­˜å‚¨é©±åŠ¨ # å®‰è£… sudo snap install docker # ä¸æ¨èï¼Œå¯èƒ½æœ‰é—®é¢˜ sudo apt update sudo apt install docker.io sudo systemctl start docker sudo systemctl enable docker # è®¾ç½®ç”¨æˆ·ç»„ sudo groupadd docker # æ–°å¢dockrç»„,å®‰è£…åä¼šæœ‰ newgrp docker # **åˆ‡æ¢ç”¨æˆ·çš„ä¸»ç»„**ï¼Œå¦åˆ™å¯èƒ½å› ä¸ºæ²¡æœ‰sudoæƒé™è¿è¡Œä¸äº†dockerå‘½ä»¤ getent group | grep docker # æŸ¥çœ‹ç»„ sudo usermod -aG docker $USER # ç»„ä¸­æ·»åŠ æˆå‘˜ # æŸ¥çœ‹æœ¬æœºé•œåƒ docker images docker images <image_name> docker images --format &#39;{{.Size}}\t{{.Repository}}:{{.Tag}}&#39; | sort -h # æŒ‰å¤§å°æ’åº docker images --no-trunc # éèŠ‚ç‚¹æŸ¥çœ‹ docker images -a # æŸ¥æ‰¾é•œåƒ æˆ‘ä»¬å¯ä»¥ä» Docker Hub ç½‘ç«™æ¥æœç´¢é•œåƒï¼ŒDocker Hub ç½‘å€ä¸ºï¼š https://hub.docker.com/ æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ docker search å‘½ä»¤æ¥æœç´¢é•œåƒã€‚æ¯”å¦‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ª httpd çš„é•œåƒæ¥ä½œä¸ºæˆ‘ä»¬çš„ web æœåŠ¡ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ docker search å‘½ä»¤æœç´¢ httpd æ¥å¯»æ‰¾é€‚åˆæˆ‘ä»¬çš„é•œåƒã€‚ runoob@runoob:~$ docker search httpd # è·å–é•œåƒ docker pull <image_name>:<tag> docker pull ubuntu #é»˜è®¤æ ‡ç­¾docker pull ubuntu docker pull ubuntu:20.04 docker pull colmap/colmap docker pull colmap/colmap:v3.7 docker pull hub-mirror.c.163.com/library/busybox:latest # æŒ‡å®šé•œåƒæº # ä¿å­˜ç¦»çº¿é•œåƒå¹¶è¿è¡Œ docker save -o <image-name>.tar <image-name>:<tag> # ä¿å­˜ä¸º tar æ–‡ä»¶ docker save -o ubuntu.tar ubuntu:latest docker load -i ubuntu.tar # å¯ä»¥ä½¿ç”¨docker imagesæŸ¥çœ‹ docker run -it ubuntu:latest /bin/bash # å¯åŠ¨å®¹å™¨ ä»¥ä¸‹å‘½ä»¤ä½¿ç”¨ ubuntu é•œåƒå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œå‚æ•°ä¸ºä»¥å‘½ä»¤è¡Œæ¨¡å¼è¿›å…¥è¯¥å®¹å™¨ï¼š $ docker run -it ubuntu /bin/bash docker run -it tensorflow/tensorflow:1.15.5-gpu id # æŸ¥çœ‹uid gid sudo docker run -it --user 1009:999 tensorflow/tensorflow:1.15.5-gpu /bin/bash docker run -it -v ~/YFJ:/share tensorflow/tensorflow:1.15.5-gpu docker run -it -v ~/Documents/python/unet_rgb:/share tensorflow/tensorflow å‚æ•°è¯´æ˜ï¼š -i: äº¤äº’å¼æ“ä½œã€‚ -t: ç»ˆç«¯ã€‚ ubuntu: ubuntu é•œåƒã€‚ /bin/bashï¼šæ”¾åœ¨é•œåƒååçš„æ˜¯å‘½ä»¤ï¼Œè¿™é‡Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸ªäº¤äº’å¼ Shellï¼Œå› æ­¤ç”¨çš„æ˜¯ /bin/bashã€‚ è¦é€€å‡ºç»ˆç«¯ï¼Œç›´æ¥è¾“å…¥ exit: # åœæ­¢å®¹å™¨ é”®ç›˜å¿«æ·é”® Ctrl + D æˆ–è€…è¾“å…¥ exit å‘½ä»¤æ¥é€€å‡ºå®¹å™¨ docker stop <container_id_or_name> docker stop $(docker ps -q) docker container prune # åˆ é™¤æ‰€æœ‰é€€å‡ºçš„å®¹å™¨ docker rm <container_id> # åˆ é™¤æŒ‡å®šå®¹å™¨ # æŸ¥çœ‹å®¹å™¨çŠ¶æ€ runoob@runoob:~$ docker ps CONTAINER ID IMAGE COMMAND ... 5917eac21c36 ubuntu:15.10 "/bin/sh -c &#39;while tâ€¦" ... # ä¸å®¿ä¸»æœºå…±äº«ç›®å½• docker run -it -v ~/shared_data:/data tensorflow/tensorflow docker run -it -v ~/YFJ:/share tensorflow/tensorflow:1.15.5-gpu # å®¹å™¨ä¸­ä¸éœ€è¦æ‰‹åŠ¨åˆ›å»ºshareç›®å½• docker run -it -v ~/YFJ/python/sediment/deeplearning/demo/unet_rgb:/share tensorflow/tensorflow:latest-gpu docker run --gpus all -it -v ~/Documents/python/unet_rgb:/share tensorflow/tensorflow:2.2.1-gpu # åˆ é™¤é•œåƒ docker rmi -f yfjie/tensorflow:latest # å¼ºåˆ¶åˆ é™¤ docker rmi -f <IMAGE ID> # æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨ docker ps docker ps -a # é•œåƒè¯¦ç»†ä¿¡æ¯ docker inspect <é•œåƒåç§°æˆ– ID> # åˆ›å»º/æ›´æ–°é•œåƒ docker commit ea78c33e150f yfjie/tensorflow # ç»æµ‹è¯•å…ˆæ›´æ–°åå†exitï¼ŒæŸäº›ç‰ˆæœ¬å¯ä»¥å…ˆexit **docker commit -m="has update" -a="runoob" e218edb10161 runoob/ubuntu:v2** docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]] # å¯ä»¥æäº¤ç›¸åŒåç§°è¦†ç›–å·²æœ‰é•œåƒ # é‡å¯ sudo snap restart docker # cudaè¿è¡Œæ—¶ which nvidia-container-runtime å¯ç”¨gpu nvidia-smi # è¾“å‡º GPU ä¿¡æ¯è¡¨ç¤ºé©±åŠ¨æ­£å¸¸ # æ·»åŠ  NVIDIA Container Toolkit çš„ GPG å¯†é’¥ curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add - # æ·»åŠ ä»“åº“æºï¼ˆé€‚ç”¨äº Ubuntu 22.04 "jammy"ï¼‰ distribution=$(. /etc/os-release;echo $ID$VERSION_ID) curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | sudo tee /etc/apt/sources.list.d/nvidia-docker.list sudo apt-get update # åœ¨æœ‰ä»£ç†çš„æƒ…å†µä¸‹å¯èƒ½æ— æ³•æ›´æ–° # å®‰è£… nvidia-container-runtime åŠç›¸å…³å·¥å…· sudo apt-get install -y nvidia-container-runtime # updateå¤±è´¥å¯èƒ½å¯¼è‡´æ— æ³•å®‰è£… # ä¹Ÿå¯ä»¥ç¦»çº¿å®‰è£…(**Recommend**) https://github.com/NVIDIA/nvidia-container-toolkit/releases #/home/cy/pkg/coding/docker/release-v1.17.3-stable/packages/ubuntu18.04/amd64 tar -zxvf nvidia-docker-1.14.1.tar.gz sudo chmod +x *.deb sudo dpkg -i ./docker-24.0.6/*.deb # åŒæ—¶å®‰è£…å¤šä¸ªdeb,é€Ÿåº¦é£å¿« # æŸ¥çœ‹ç‰ˆæœ¬ nvidia-container-runtime --version sudo nano /etc/docker/daemon.json # å†…å®¹å¦‚ä¸‹ï¼Œå®‰è£…åå¦‚è‡ªåŠ¨ç”Ÿæˆä¹Ÿå¯ä»¥ä¸ç”¨æ”¹ { "runtimes": { "nvidia": { "path": "/usr/bin/nvidia-container-runtime", "runtimeArgs": [] } }, "default-runtime": "nvidia" } or,**recommended** this { "default-runtime": "nvidia", "runtimes": { "nvidia": { "args": [], "path": "nvidia-container-runtime" } } } # ä½¿æ›´æ”¹ç”Ÿæ•ˆ sudo systemctl daemon-reload # å¯èƒ½ä¸éœ€è¦ sudo systemctl restart docker # æŸ¥çœ‹nvidia-container-runtimeå®‰è£…ä½ç½® which nvidia-container-runtime sudo nvidia-ctk runtime configure --runtime=docker # testï¼Œåº”æ˜¾ç¤ºä¸å®¿ä¸»æœºç›¸åŒçš„ GPU ä¿¡æ¯ï¼ˆCUDAè¿è¡Œæ—¶éœ€è¦è·Ÿé•œåƒçš„åŒ¹é…ï¼‰ docker run --rm --gpus all nvidia/cuda:11.8.0-base-ubuntu22.04 nvidia-smi docker run -it --gpus &#39;"device=0,2"&#39; --shm-size 32g image_name:tag_name # æŒ‡å®šgpu deepseek åœ¨ Ubuntu 22.04 ä¸Šå®‰è£… nvidia-container-runtime çš„æ­¥éª¤å¦‚ä¸‹ï¼š'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-10-17T00:00:00+00:00"><meta property="article:modified_time" content="2025-04-29T00:00:00+00:00"><meta property="article:tag" content="Docker"><meta name=twitter:card content="summary"><meta name=twitter:title content="docker"><meta name=twitter:description content='dockerfile
https://www.runoob.com/docker/docker-image-usage.html
https://hub.docker.com/
# æŸ¥çœ‹dockerç‰ˆæœ¬ docker --version docker -v docker info | grep "Storage Driver" # å½“å‰ä½¿ç”¨çš„å­˜å‚¨é©±åŠ¨ # å®‰è£… sudo snap install docker # ä¸æ¨èï¼Œå¯èƒ½æœ‰é—®é¢˜ sudo apt update sudo apt install docker.io sudo systemctl start docker sudo systemctl enable docker # è®¾ç½®ç”¨æˆ·ç»„ sudo groupadd docker # æ–°å¢dockrç»„,å®‰è£…åä¼šæœ‰ newgrp docker # **åˆ‡æ¢ç”¨æˆ·çš„ä¸»ç»„**ï¼Œå¦åˆ™å¯èƒ½å› ä¸ºæ²¡æœ‰sudoæƒé™è¿è¡Œä¸äº†dockerå‘½ä»¤ getent group | grep docker # æŸ¥çœ‹ç»„ sudo usermod -aG docker $USER # ç»„ä¸­æ·»åŠ æˆå‘˜ # æŸ¥çœ‹æœ¬æœºé•œåƒ docker images docker images <image_name> docker images --format &#39;{{.Size}}\t{{.Repository}}:{{.Tag}}&#39; | sort -h # æŒ‰å¤§å°æ’åº docker images --no-trunc # éèŠ‚ç‚¹æŸ¥çœ‹ docker images -a # æŸ¥æ‰¾é•œåƒ æˆ‘ä»¬å¯ä»¥ä» Docker Hub ç½‘ç«™æ¥æœç´¢é•œåƒï¼ŒDocker Hub ç½‘å€ä¸ºï¼š https://hub.docker.com/ æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ docker search å‘½ä»¤æ¥æœç´¢é•œåƒã€‚æ¯”å¦‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ª httpd çš„é•œåƒæ¥ä½œä¸ºæˆ‘ä»¬çš„ web æœåŠ¡ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ docker search å‘½ä»¤æœç´¢ httpd æ¥å¯»æ‰¾é€‚åˆæˆ‘ä»¬çš„é•œåƒã€‚ runoob@runoob:~$ docker search httpd # è·å–é•œåƒ docker pull <image_name>:<tag> docker pull ubuntu #é»˜è®¤æ ‡ç­¾docker pull ubuntu docker pull ubuntu:20.04 docker pull colmap/colmap docker pull colmap/colmap:v3.7 docker pull hub-mirror.c.163.com/library/busybox:latest # æŒ‡å®šé•œåƒæº # ä¿å­˜ç¦»çº¿é•œåƒå¹¶è¿è¡Œ docker save -o <image-name>.tar <image-name>:<tag> # ä¿å­˜ä¸º tar æ–‡ä»¶ docker save -o ubuntu.tar ubuntu:latest docker load -i ubuntu.tar # å¯ä»¥ä½¿ç”¨docker imagesæŸ¥çœ‹ docker run -it ubuntu:latest /bin/bash # å¯åŠ¨å®¹å™¨ ä»¥ä¸‹å‘½ä»¤ä½¿ç”¨ ubuntu é•œåƒå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œå‚æ•°ä¸ºä»¥å‘½ä»¤è¡Œæ¨¡å¼è¿›å…¥è¯¥å®¹å™¨ï¼š $ docker run -it ubuntu /bin/bash docker run -it tensorflow/tensorflow:1.15.5-gpu id # æŸ¥çœ‹uid gid sudo docker run -it --user 1009:999 tensorflow/tensorflow:1.15.5-gpu /bin/bash docker run -it -v ~/YFJ:/share tensorflow/tensorflow:1.15.5-gpu docker run -it -v ~/Documents/python/unet_rgb:/share tensorflow/tensorflow å‚æ•°è¯´æ˜ï¼š -i: äº¤äº’å¼æ“ä½œã€‚ -t: ç»ˆç«¯ã€‚ ubuntu: ubuntu é•œåƒã€‚ /bin/bashï¼šæ”¾åœ¨é•œåƒååçš„æ˜¯å‘½ä»¤ï¼Œè¿™é‡Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸ªäº¤äº’å¼ Shellï¼Œå› æ­¤ç”¨çš„æ˜¯ /bin/bashã€‚ è¦é€€å‡ºç»ˆç«¯ï¼Œç›´æ¥è¾“å…¥ exit: # åœæ­¢å®¹å™¨ é”®ç›˜å¿«æ·é”® Ctrl + D æˆ–è€…è¾“å…¥ exit å‘½ä»¤æ¥é€€å‡ºå®¹å™¨ docker stop <container_id_or_name> docker stop $(docker ps -q) docker container prune # åˆ é™¤æ‰€æœ‰é€€å‡ºçš„å®¹å™¨ docker rm <container_id> # åˆ é™¤æŒ‡å®šå®¹å™¨ # æŸ¥çœ‹å®¹å™¨çŠ¶æ€ runoob@runoob:~$ docker ps CONTAINER ID IMAGE COMMAND ... 5917eac21c36 ubuntu:15.10 "/bin/sh -c &#39;while tâ€¦" ... # ä¸å®¿ä¸»æœºå…±äº«ç›®å½• docker run -it -v ~/shared_data:/data tensorflow/tensorflow docker run -it -v ~/YFJ:/share tensorflow/tensorflow:1.15.5-gpu # å®¹å™¨ä¸­ä¸éœ€è¦æ‰‹åŠ¨åˆ›å»ºshareç›®å½• docker run -it -v ~/YFJ/python/sediment/deeplearning/demo/unet_rgb:/share tensorflow/tensorflow:latest-gpu docker run --gpus all -it -v ~/Documents/python/unet_rgb:/share tensorflow/tensorflow:2.2.1-gpu # åˆ é™¤é•œåƒ docker rmi -f yfjie/tensorflow:latest # å¼ºåˆ¶åˆ é™¤ docker rmi -f <IMAGE ID> # æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨ docker ps docker ps -a # é•œåƒè¯¦ç»†ä¿¡æ¯ docker inspect <é•œåƒåç§°æˆ– ID> # åˆ›å»º/æ›´æ–°é•œåƒ docker commit ea78c33e150f yfjie/tensorflow # ç»æµ‹è¯•å…ˆæ›´æ–°åå†exitï¼ŒæŸäº›ç‰ˆæœ¬å¯ä»¥å…ˆexit **docker commit -m="has update" -a="runoob" e218edb10161 runoob/ubuntu:v2** docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]] # å¯ä»¥æäº¤ç›¸åŒåç§°è¦†ç›–å·²æœ‰é•œåƒ # é‡å¯ sudo snap restart docker # cudaè¿è¡Œæ—¶ which nvidia-container-runtime å¯ç”¨gpu nvidia-smi # è¾“å‡º GPU ä¿¡æ¯è¡¨ç¤ºé©±åŠ¨æ­£å¸¸ # æ·»åŠ  NVIDIA Container Toolkit çš„ GPG å¯†é’¥ curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add - # æ·»åŠ ä»“åº“æºï¼ˆé€‚ç”¨äº Ubuntu 22.04 "jammy"ï¼‰ distribution=$(. /etc/os-release;echo $ID$VERSION_ID) curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | sudo tee /etc/apt/sources.list.d/nvidia-docker.list sudo apt-get update # åœ¨æœ‰ä»£ç†çš„æƒ…å†µä¸‹å¯èƒ½æ— æ³•æ›´æ–° # å®‰è£… nvidia-container-runtime åŠç›¸å…³å·¥å…· sudo apt-get install -y nvidia-container-runtime # updateå¤±è´¥å¯èƒ½å¯¼è‡´æ— æ³•å®‰è£… # ä¹Ÿå¯ä»¥ç¦»çº¿å®‰è£…(**Recommend**) https://github.com/NVIDIA/nvidia-container-toolkit/releases #/home/cy/pkg/coding/docker/release-v1.17.3-stable/packages/ubuntu18.04/amd64 tar -zxvf nvidia-docker-1.14.1.tar.gz sudo chmod +x *.deb sudo dpkg -i ./docker-24.0.6/*.deb # åŒæ—¶å®‰è£…å¤šä¸ªdeb,é€Ÿåº¦é£å¿« # æŸ¥çœ‹ç‰ˆæœ¬ nvidia-container-runtime --version sudo nano /etc/docker/daemon.json # å†…å®¹å¦‚ä¸‹ï¼Œå®‰è£…åå¦‚è‡ªåŠ¨ç”Ÿæˆä¹Ÿå¯ä»¥ä¸ç”¨æ”¹ { "runtimes": { "nvidia": { "path": "/usr/bin/nvidia-container-runtime", "runtimeArgs": [] } }, "default-runtime": "nvidia" } or,**recommended** this { "default-runtime": "nvidia", "runtimes": { "nvidia": { "args": [], "path": "nvidia-container-runtime" } } } # ä½¿æ›´æ”¹ç”Ÿæ•ˆ sudo systemctl daemon-reload # å¯èƒ½ä¸éœ€è¦ sudo systemctl restart docker # æŸ¥çœ‹nvidia-container-runtimeå®‰è£…ä½ç½® which nvidia-container-runtime sudo nvidia-ctk runtime configure --runtime=docker # testï¼Œåº”æ˜¾ç¤ºä¸å®¿ä¸»æœºç›¸åŒçš„ GPU ä¿¡æ¯ï¼ˆCUDAè¿è¡Œæ—¶éœ€è¦è·Ÿé•œåƒçš„åŒ¹é…ï¼‰ docker run --rm --gpus all nvidia/cuda:11.8.0-base-ubuntu22.04 nvidia-smi docker run -it --gpus &#39;"device=0,2"&#39; --shm-size 32g image_name:tag_name # æŒ‡å®šgpu deepseek åœ¨ Ubuntu 22.04 ä¸Šå®‰è£… nvidia-container-runtime çš„æ­¥éª¤å¦‚ä¸‹ï¼š'><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://fjyu95.github.io/posts/docker-199e4020f06080f09e9cd8f239bcf9e7/><link rel=prev href=https://fjyu95.github.io/posts/linux-command-de039fc517af4e2bb44d03ac1dc38fc3/><link rel=next href=https://fjyu95.github.io/posts/git-bash-6e38abb2523440e89cbd0524226ca63a/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"docker","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/fjyu95.github.io\/posts\/docker-199e4020f06080f09e9cd8f239bcf9e7\/"},"genre":"posts","keywords":"docker","wordcount":4483,"url":"https:\/\/fjyu95.github.io\/posts\/docker-199e4020f06080f09e9cd8f239bcf9e7\/","datePublished":"2022-10-17T00:00:00+00:00","dateModified":"2025-04-29T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"fjyu95"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="FangjieYuâ€˜s site">fjyu95</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>posts </a><a class=menu-item href=/tags/>tags </a><a class=menu-item href=/categories/>category </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="FangjieYuâ€˜s site">fjyu95</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>posts</a><a class=menu-item href=/tags/ title>tags</a><a class=menu-item href=/categories/ title>category</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">docker</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://fjyu95.github.io/ title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>fjyu95</a></span>&nbsp;<span class=post-category>included in <a href=/categories/linux%E7%AC%94%E8%AE%B0/><i class="far fa-folder fa-fw" aria-hidden=true></i>Linuxç¬”è®°</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-10-17>2022-10-17</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;4483 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;9 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#å¯ç”¨gpu>å¯ç”¨gpu</a><ul><li><a href=#deepseek>deepseek</a><ul><li><a href=#1-å®‰è£…å‰ææ¡ä»¶><strong>1. å®‰è£…å‰ææ¡ä»¶</strong></a></li><li><a href=#2-é…ç½®-nvidia-container-toolkit-ä»“åº“><strong>2. é…ç½® NVIDIA Container Toolkit ä»“åº“</strong></a></li><li><a href=#1-æ·»åŠ ä»“åº“å¯†é’¥å’Œæº><strong>(1) æ·»åŠ ä»“åº“å¯†é’¥å’Œæº</strong></a></li><li><a href=#2-æ›´æ–°åŒ…åˆ—è¡¨><strong>(2) æ›´æ–°åŒ…åˆ—è¡¨</strong></a></li><li><a href=#3-å®‰è£…-nvidia-container-runtime><strong>3. å®‰è£… NVIDIA Container Runtime</strong></a></li><li><a href=#4-é…ç½®-docker-ä½¿ç”¨-nvidia-è¿è¡Œæ—¶><strong>4. é…ç½® Docker ä½¿ç”¨ NVIDIA è¿è¡Œæ—¶</strong></a></li><li><a href=#1-ç¼–è¾‘-docker-é…ç½®æ–‡ä»¶><strong>(1) ç¼–è¾‘ Docker é…ç½®æ–‡ä»¶</strong></a></li><li><a href=#2-æ·»åŠ ä»¥ä¸‹å†…å®¹><strong>(2) æ·»åŠ ä»¥ä¸‹å†…å®¹</strong></a></li><li><a href=#3-ä¿å­˜å¹¶é€€å‡ºç¼–è¾‘å™¨><strong>(3) ä¿å­˜å¹¶é€€å‡ºç¼–è¾‘å™¨</strong></a></li><li><a href=#4-é‡å¯-docker-æœåŠ¡><strong>(4) é‡å¯ Docker æœåŠ¡</strong></a></li><li><a href=#5-éªŒè¯å®‰è£…><strong>5. éªŒè¯å®‰è£…</strong></a></li><li><a href=#1-è¿è¡Œæµ‹è¯•å®¹å™¨><strong>(1) è¿è¡Œæµ‹è¯•å®¹å™¨</strong></a></li><li><a href=#2-é¢„æœŸè¾“å‡º><strong>(2) é¢„æœŸè¾“å‡º</strong></a></li><li><a href=#6-å¸¸è§é—®é¢˜è§£å†³><strong>6. å¸¸è§é—®é¢˜è§£å†³</strong></a></li><li><a href=#1-æŠ¥é”™><strong>(1) æŠ¥é”™ &ldquo;Failed to initialize NVML: Driver/library version mismatch&rdquo;</strong></a></li><li><a href=#2-æŠ¥é”™><strong>(2) æŠ¥é”™ &ldquo;nvidia-container-runtime not found&rdquo;</strong></a></li><li><a href=#3-docker-æœåŠ¡å¯åŠ¨å¤±è´¥><strong>(3) Docker æœåŠ¡å¯åŠ¨å¤±è´¥</strong></a></li><li><a href=#7-æ‰©å±•é…ç½®å¯é€‰><strong>7. æ‰©å±•é…ç½®ï¼ˆå¯é€‰ï¼‰</strong></a></li><li><a href=#1-é™åˆ¶å®¹å™¨-gpu-è®¿é—®><strong>(1) é™åˆ¶å®¹å™¨ GPU è®¿é—®</strong></a></li><li><a href=#2-å®‰è£…-nvidia-docker2æ—§ç‰ˆå…¼å®¹><strong>(2) å®‰è£… nvidia-docker2ï¼ˆæ—§ç‰ˆå…¼å®¹ï¼‰</strong></a></li><li><a href=#æ€»ç»“><strong>æ€»ç»“</strong></a></li></ul></li><li><a href=#faq>FAQ</a></li></ul></li><li><a href=#é•œåƒåŠ é€Ÿ><strong>é•œåƒåŠ é€Ÿ</strong></a><ul><li><ul><li><a href=#ç¦»çº¿å®‰è£…>ç¦»çº¿å®‰è£…</a></li><li><a href=#é…ç½®æ— æ•ˆé—®é¢˜>é…ç½®æ— æ•ˆé—®é¢˜</a></li></ul></li></ul></li><li><a href=#å¤šä¸ªç›®å½•æ˜ å°„>å¤šä¸ªç›®å½•æ˜ å°„</a><ul><li><ul><li><a href=#ä½¿ç”¨-v-é€‰é¡¹æŒ‚è½½å¤šä¸ªç›®å½•>ä½¿ç”¨ <code>v</code> é€‰é¡¹æŒ‚è½½å¤šä¸ªç›®å½•ï¼š</a></li></ul></li></ul></li><li><a href=#ä¿®æ”¹å®¹å™¨å†…apté•œåƒæº>ä¿®æ”¹å®¹å™¨å†…apté•œåƒæº</a></li><li><a href=#å®¹å™¨id>å®¹å™¨id</a></li><li><a href=#è¿ç§»å¯¼å‡º>è¿ç§»å¯¼å‡º</a><ul><li><ul><li><a href=#å®¹å™¨è¿ç§»å¦‚æœéœ€è¦ä¿ç•™è¿è¡ŒçŠ¶æ€æŒ‚è½½>å®¹å™¨è¿ç§»ï¼ˆå¦‚æœéœ€è¦ä¿ç•™è¿è¡ŒçŠ¶æ€ã€æŒ‚è½½ï¼‰</a></li></ul></li></ul></li><li><a href=#é…ç½®ä»£ç†>é…ç½®ä»£ç†</a><ul><li><ul><li><a href=#linux-ç³»ç»Ÿ>Linux ç³»ç»Ÿ</a></li><li><a href=#ç³»ç»Ÿçº§ä»£ç†é…ç½®>ç³»ç»Ÿçº§ä»£ç†é…ç½®</a></li><li><a href=#å®¹å™¨çº§ä»£ç†é…ç½®>å®¹å™¨çº§ä»£ç†é…ç½®</a></li><li><a href=#windows-ç³»ç»Ÿ>Windows ç³»ç»Ÿ</a></li><li><a href=#docker-desktop-é…ç½®>Docker Desktop é…ç½®</a></li><li><a href=#macos-ç³»ç»Ÿ>macOS ç³»ç»Ÿ</a></li><li><a href=#docker-desktop-é…ç½®-1>Docker Desktop é…ç½®</a></li></ul></li></ul></li><li><a href=#faq-1>FAQ</a><ul><li><a href=#ä¸´æ—¶æå‡æƒé™æ“ä½œæ–‡ä»¶>ä¸´æ—¶æå‡æƒé™æ“ä½œæ–‡ä»¶</a></li><li><a href=#-å®ç°æ­¥éª¤æœ‰-root-æƒé™å‰æ>âœ… å®ç°æ­¥éª¤ï¼ˆæœ‰ root æƒé™å‰æï¼‰</a><ul><li><a href=#-åœºæ™¯ç›®æ ‡>ğŸ§± åœºæ™¯ç›®æ ‡ï¼š</a></li></ul></li><li><a href=#-å‰ææ¡ä»¶>ğŸ” å‰ææ¡ä»¶</a></li><li><a href=#-ç¤ºä¾‹æŒ‚è½½å®¿ä¸»æœºä»»æ„ç›®å½•å¹¶ä¿®æ”¹æƒé™>ğŸ§ª ç¤ºä¾‹ï¼šæŒ‚è½½å®¿ä¸»æœºä»»æ„ç›®å½•å¹¶ä¿®æ”¹æƒé™</a></li><li><a href=#-ä¿®æ”¹ä»»æ„ç›®å½•æƒé™çš„æŠ€å·§å¸¸ç”¨>ğŸ› ï¸ ä¿®æ”¹ä»»æ„ç›®å½•æƒé™çš„æŠ€å·§ï¼ˆå¸¸ç”¨ï¼‰</a></li><li><a href=#-é£é™©æé†’>âš ï¸ é£é™©æé†’</a></li><li><a href=#-æ¨èæ›¿ä»£æ–¹æ¡ˆå®‰å…¨åšæ³•>âœ… æ¨èæ›¿ä»£æ–¹æ¡ˆï¼ˆå®‰å…¨åšæ³•ï¼‰</a></li><li><a href=#-æ€»ç»“ä¸€å¥è¯>ğŸ¯ æ€»ç»“ä¸€å¥è¯ï¼š</a></li><li><a href=#-è„šæœ¬fix-permssh>âœ… è„šæœ¬ï¼š<code>fix-perms.sh</code></a></li><li><a href=#-ç”¨æ³•>ğŸ”§ ç”¨æ³•</a></li><li><a href=#-å¯é€‰å¢å¼ºåŠŸèƒ½>ğŸ“Œ å¯é€‰å¢å¼ºåŠŸèƒ½</a></li><li><a href=#-æ³¨æ„äº‹é¡¹>ğŸš¨ æ³¨æ„äº‹é¡¹</a></li></ul></li></ul></nav></div></div><div class=content id=content><p><a href="https://www.notion.so/dockerfile-1e3e4020f060809ba1b0faec481beaa0?pvs=21" target=_blank rel="noopener noreffer">dockerfile</a></p><p><a href=https://www.runoob.com/docker/docker-image-usage.html target=_blank rel="noopener noreffer">https://www.runoob.com/docker/docker-image-usage.html</a></p><p><a href=https://hub.docker.com/ target=_blank rel="noopener noreffer">https://hub.docker.com/</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># æŸ¥çœ‹dockerç‰ˆæœ¬</span>
</span></span><span class=line><span class=cl>docker --version
</span></span><span class=line><span class=cl>docker -v
</span></span><span class=line><span class=cl>docker info <span class=p>|</span> grep <span class=s2>&#34;Storage Driver&#34;</span> <span class=c1># å½“å‰ä½¿ç”¨çš„å­˜å‚¨é©±åŠ¨</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å®‰è£…</span>
</span></span><span class=line><span class=cl>sudo snap install docker <span class=c1># ä¸æ¨èï¼Œå¯èƒ½æœ‰é—®é¢˜</span>
</span></span><span class=line><span class=cl>sudo apt update
</span></span><span class=line><span class=cl>sudo apt install docker.io
</span></span><span class=line><span class=cl>sudo systemctl start docker
</span></span><span class=line><span class=cl>sudo systemctl <span class=nb>enable</span> docker
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># è®¾ç½®ç”¨æˆ·ç»„</span>
</span></span><span class=line><span class=cl>sudo groupadd docker <span class=c1># æ–°å¢dockrç»„,å®‰è£…åä¼šæœ‰</span>
</span></span><span class=line><span class=cl>newgrp docker <span class=c1># **åˆ‡æ¢ç”¨æˆ·çš„ä¸»ç»„**ï¼Œå¦åˆ™å¯èƒ½å› ä¸ºæ²¡æœ‰sudoæƒé™è¿è¡Œä¸äº†dockerå‘½ä»¤</span>
</span></span><span class=line><span class=cl>getent group <span class=p>|</span> grep docker <span class=c1># æŸ¥çœ‹ç»„</span>
</span></span><span class=line><span class=cl>sudo usermod -aG docker <span class=nv>$USER</span> <span class=c1># ç»„ä¸­æ·»åŠ æˆå‘˜</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹æœ¬æœºé•œåƒ</span>
</span></span><span class=line><span class=cl>docker images
</span></span><span class=line><span class=cl>docker images &lt;image_name&gt;
</span></span><span class=line><span class=cl>docker images --format <span class=s1>&#39;{{.Size}}\t{{.Repository}}:{{.Tag}}&#39;</span> <span class=p>|</span> sort -h <span class=c1># æŒ‰å¤§å°æ’åº</span>
</span></span><span class=line><span class=cl>docker images --no-trunc <span class=c1># éèŠ‚ç‚¹æŸ¥çœ‹</span>
</span></span><span class=line><span class=cl>docker images -a
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥æ‰¾é•œåƒ</span>
</span></span><span class=line><span class=cl>æˆ‘ä»¬å¯ä»¥ä» Docker Hub ç½‘ç«™æ¥æœç´¢é•œåƒï¼ŒDocker Hub ç½‘å€ä¸ºï¼š https://hub.docker.com/
</span></span><span class=line><span class=cl>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ docker search å‘½ä»¤æ¥æœç´¢é•œåƒã€‚æ¯”å¦‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ª httpd çš„é•œåƒæ¥ä½œä¸ºæˆ‘ä»¬çš„ web æœåŠ¡ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ docker search å‘½ä»¤æœç´¢ httpd æ¥å¯»æ‰¾é€‚åˆæˆ‘ä»¬çš„é•œåƒã€‚
</span></span><span class=line><span class=cl>runoob@runoob:~$  docker search httpd
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># è·å–é•œåƒ</span>
</span></span><span class=line><span class=cl>docker pull &lt;image_name&gt;:&lt;tag&gt;
</span></span><span class=line><span class=cl>docker pull ubuntu <span class=c1>#é»˜è®¤æ ‡ç­¾docker pull ubuntu</span>
</span></span><span class=line><span class=cl>docker pull ubuntu:20.04
</span></span><span class=line><span class=cl>docker pull colmap/colmap
</span></span><span class=line><span class=cl>docker pull colmap/colmap:v3.7
</span></span><span class=line><span class=cl>docker pull hub-mirror.c.163.com/library/busybox:latest <span class=c1># æŒ‡å®šé•œåƒæº</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä¿å­˜ç¦»çº¿é•œåƒå¹¶è¿è¡Œ</span>
</span></span><span class=line><span class=cl>docker save -o &lt;image-name&gt;.tar &lt;image-name&gt;:&lt;tag&gt; <span class=c1># ä¿å­˜ä¸º tar æ–‡ä»¶</span>
</span></span><span class=line><span class=cl>docker save -o ubuntu.tar ubuntu:latest
</span></span><span class=line><span class=cl>docker load -i ubuntu.tar <span class=c1># å¯ä»¥ä½¿ç”¨docker imagesæŸ¥çœ‹</span>
</span></span><span class=line><span class=cl>docker run -it ubuntu:latest /bin/bash
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å¯åŠ¨å®¹å™¨</span>
</span></span><span class=line><span class=cl>ä»¥ä¸‹å‘½ä»¤ä½¿ç”¨ ubuntu é•œåƒå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œå‚æ•°ä¸ºä»¥å‘½ä»¤è¡Œæ¨¡å¼è¿›å…¥è¯¥å®¹å™¨ï¼š
</span></span><span class=line><span class=cl>$ docker run -it ubuntu /bin/bash
</span></span><span class=line><span class=cl>docker run -it tensorflow/tensorflow:1.15.5-gpu
</span></span><span class=line><span class=cl>id <span class=c1># æŸ¥çœ‹uid gid</span>
</span></span><span class=line><span class=cl>sudo docker run -it --user 1009:999 tensorflow/tensorflow:1.15.5-gpu /bin/bash
</span></span><span class=line><span class=cl>docker run -it -v ~/YFJ:/share tensorflow/tensorflow:1.15.5-gpu
</span></span><span class=line><span class=cl>docker run -it -v ~/Documents/python/unet_rgb:/share tensorflow/tensorflow
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>å‚æ•°è¯´æ˜ï¼š
</span></span><span class=line><span class=cl>-i: äº¤äº’å¼æ“ä½œã€‚
</span></span><span class=line><span class=cl>-t: ç»ˆç«¯ã€‚
</span></span><span class=line><span class=cl>ubuntu: ubuntu é•œåƒã€‚
</span></span><span class=line><span class=cl>/bin/bashï¼šæ”¾åœ¨é•œåƒååçš„æ˜¯å‘½ä»¤ï¼Œè¿™é‡Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸ªäº¤äº’å¼ Shellï¼Œå› æ­¤ç”¨çš„æ˜¯ /bin/bashã€‚
</span></span><span class=line><span class=cl>è¦é€€å‡ºç»ˆç«¯ï¼Œç›´æ¥è¾“å…¥ exit:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åœæ­¢å®¹å™¨</span>
</span></span><span class=line><span class=cl>é”®ç›˜å¿«æ·é”® Ctrl + D æˆ–è€…è¾“å…¥ <span class=nb>exit</span> å‘½ä»¤æ¥é€€å‡ºå®¹å™¨
</span></span><span class=line><span class=cl>docker stop &lt;container_id_or_name&gt;
</span></span><span class=line><span class=cl>docker stop <span class=k>$(</span>docker ps -q<span class=k>)</span>
</span></span><span class=line><span class=cl>docker container prune  <span class=c1># åˆ é™¤æ‰€æœ‰é€€å‡ºçš„å®¹å™¨</span>
</span></span><span class=line><span class=cl>docker rm &lt;container_id&gt;  <span class=c1># åˆ é™¤æŒ‡å®šå®¹å™¨</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹å®¹å™¨çŠ¶æ€</span>
</span></span><span class=line><span class=cl>runoob@runoob:~$ docker ps
</span></span><span class=line><span class=cl>CONTAINER ID        IMAGE                  COMMAND              ...  
</span></span><span class=line><span class=cl>5917eac21c36        ubuntu:15.10           <span class=s2>&#34;/bin/sh -c &#39;while tâ€¦&#34;</span>    ...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä¸å®¿ä¸»æœºå…±äº«ç›®å½•</span>
</span></span><span class=line><span class=cl>docker run -it -v ~/shared_data:/data tensorflow/tensorflow
</span></span><span class=line><span class=cl>docker run -it -v ~/YFJ:/share tensorflow/tensorflow:1.15.5-gpu <span class=c1># å®¹å™¨ä¸­ä¸éœ€è¦æ‰‹åŠ¨åˆ›å»ºshareç›®å½•</span>
</span></span><span class=line><span class=cl>docker run -it -v ~/YFJ/python/sediment/deeplearning/demo/unet_rgb:/share tensorflow/tensorflow:latest-gpu
</span></span><span class=line><span class=cl>docker run --gpus all -it -v ~/Documents/python/unet_rgb:/share tensorflow/tensorflow:2.2.1-gpu
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ é™¤é•œåƒ</span>
</span></span><span class=line><span class=cl>docker rmi -f yfjie/tensorflow:latest <span class=c1># å¼ºåˆ¶åˆ é™¤</span>
</span></span><span class=line><span class=cl>docker rmi -f &lt;IMAGE ID&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨</span>
</span></span><span class=line><span class=cl>docker ps
</span></span><span class=line><span class=cl>docker ps -a
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># é•œåƒè¯¦ç»†ä¿¡æ¯</span>
</span></span><span class=line><span class=cl>docker inspect &lt;é•œåƒåç§°æˆ– ID&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># åˆ›å»º/æ›´æ–°é•œåƒ</span>
</span></span><span class=line><span class=cl>docker commit ea78c33e150f yfjie/tensorflow <span class=c1># ç»æµ‹è¯•å…ˆæ›´æ–°åå†exitï¼ŒæŸäº›ç‰ˆæœ¬å¯ä»¥å…ˆexit</span>
</span></span><span class=line><span class=cl>**docker commit -m<span class=o>=</span><span class=s2>&#34;has update&#34;</span> -a<span class=o>=</span><span class=s2>&#34;runoob&#34;</span> e218edb10161 runoob/ubuntu:v2**
</span></span><span class=line><span class=cl>docker commit <span class=o>[</span>OPTIONS<span class=o>]</span> CONTAINER <span class=o>[</span>REPOSITORY<span class=o>[</span>:TAG<span class=o>]]</span> <span class=c1># å¯ä»¥æäº¤ç›¸åŒåç§°è¦†ç›–å·²æœ‰é•œåƒ</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># é‡å¯</span>
</span></span><span class=line><span class=cl>sudo snap restart docker
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># cudaè¿è¡Œæ—¶</span>
</span></span><span class=line><span class=cl>which nvidia-container-runtime
</span></span></code></pre></div><h1 id=å¯ç”¨gpu>å¯ç”¨gpu</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nvidia-smi  <span class=c1># è¾“å‡º GPU ä¿¡æ¯è¡¨ç¤ºé©±åŠ¨æ­£å¸¸</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ·»åŠ  NVIDIA Container Toolkit çš„ GPG å¯†é’¥</span>
</span></span><span class=line><span class=cl>curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey <span class=p>|</span> sudo apt-key add -
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ·»åŠ ä»“åº“æºï¼ˆé€‚ç”¨äº Ubuntu 22.04 &#34;jammy&#34;ï¼‰</span>
</span></span><span class=line><span class=cl><span class=nv>distribution</span><span class=o>=</span><span class=k>$(</span>. /etc/os-release<span class=p>;</span><span class=nb>echo</span> <span class=nv>$ID$VERSION_ID</span><span class=k>)</span>
</span></span><span class=line><span class=cl>curl -s -L https://nvidia.github.io/nvidia-docker/<span class=nv>$distribution</span>/nvidia-docker.list <span class=p>|</span> sudo tee /etc/apt/sources.list.d/nvidia-docker.list
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo apt-get update <span class=c1># åœ¨æœ‰ä»£ç†çš„æƒ…å†µä¸‹å¯èƒ½æ— æ³•æ›´æ–°</span>
</span></span><span class=line><span class=cl><span class=c1># å®‰è£… nvidia-container-runtime åŠç›¸å…³å·¥å…·</span>
</span></span><span class=line><span class=cl>sudo apt-get install -y nvidia-container-runtime <span class=c1># updateå¤±è´¥å¯èƒ½å¯¼è‡´æ— æ³•å®‰è£…</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä¹Ÿå¯ä»¥ç¦»çº¿å®‰è£…(**Recommend**)</span>
</span></span><span class=line><span class=cl>https://github.com/NVIDIA/nvidia-container-toolkit/releases
</span></span><span class=line><span class=cl><span class=c1>#/home/cy/pkg/coding/docker/release-v1.17.3-stable/packages/ubuntu18.04/amd64</span>
</span></span><span class=line><span class=cl>tar -zxvf nvidia-docker-1.14.1.tar.gz
</span></span><span class=line><span class=cl>sudo chmod +x *.deb
</span></span><span class=line><span class=cl>sudo dpkg -i ./docker-24.0.6/*.deb <span class=c1># åŒæ—¶å®‰è£…å¤šä¸ªdeb,é€Ÿåº¦é£å¿«</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹ç‰ˆæœ¬</span>
</span></span><span class=line><span class=cl>nvidia-container-runtime --version 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo nano /etc/docker/daemon.json
</span></span><span class=line><span class=cl><span class=c1># å†…å®¹å¦‚ä¸‹ï¼Œå®‰è£…åå¦‚è‡ªåŠ¨ç”Ÿæˆä¹Ÿå¯ä»¥ä¸ç”¨æ”¹</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;runtimes&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;nvidia&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;path&#34;</span>: <span class=s2>&#34;/usr/bin/nvidia-container-runtime&#34;</span>,
</span></span><span class=line><span class=cl>      <span class=s2>&#34;runtimeArgs&#34;</span>: <span class=o>[]</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;default-runtime&#34;</span>: <span class=s2>&#34;nvidia&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>or,**recommended** this
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;default-runtime&#34;</span>: <span class=s2>&#34;nvidia&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;runtimes&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;nvidia&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;args&#34;</span>: <span class=o>[]</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;path&#34;</span>: <span class=s2>&#34;nvidia-container-runtime&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä½¿æ›´æ”¹ç”Ÿæ•ˆ</span>
</span></span><span class=line><span class=cl>sudo systemctl daemon-reload <span class=c1># å¯èƒ½ä¸éœ€è¦</span>
</span></span><span class=line><span class=cl>sudo systemctl restart docker
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹nvidia-container-runtimeå®‰è£…ä½ç½®</span>
</span></span><span class=line><span class=cl>which nvidia-container-runtime
</span></span><span class=line><span class=cl>sudo nvidia-ctk runtime configure --runtime<span class=o>=</span>docker
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># testï¼Œåº”æ˜¾ç¤ºä¸å®¿ä¸»æœºç›¸åŒçš„ GPU ä¿¡æ¯ï¼ˆCUDAè¿è¡Œæ—¶éœ€è¦è·Ÿé•œåƒçš„åŒ¹é…ï¼‰</span>
</span></span><span class=line><span class=cl>docker run --rm --gpus all nvidia/cuda:11.8.0-base-ubuntu22.04 nvidia-smi
</span></span><span class=line><span class=cl>docker run -it --gpus <span class=s1>&#39;&#34;device=0,2&#34;&#39;</span> --shm-size 32g image_name:tag_name <span class=c1># æŒ‡å®šgpu  </span>
</span></span></code></pre></div><h2 id=deepseek>deepseek</h2><p>åœ¨ Ubuntu 22.04 ä¸Šå®‰è£… <code>nvidia-container-runtime</code> çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><hr><h3 id=1-å®‰è£…å‰ææ¡ä»¶><strong>1. å®‰è£…å‰ææ¡ä»¶</strong></h3><ul><li><p><strong>å·²å®‰è£… NVIDIA é©±åŠ¨ç¨‹åº</strong>
ç¡®ä¿ NVIDIA é©±åŠ¨å·²æ­£ç¡®å®‰è£…ï¼Œå¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤éªŒè¯ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nvidia-smi  <span class=c1># è¾“å‡º GPU ä¿¡æ¯è¡¨ç¤ºé©±åŠ¨æ­£å¸¸</span>
</span></span></code></pre></div></li><li><p><strong>å·²å®‰è£… Docker å¼•æ“</strong>
è‹¥æœªå®‰è£… Dockerï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt-get update
</span></span><span class=line><span class=cl>sudo apt-get install docker.io
</span></span><span class=line><span class=cl>sudo systemctl <span class=nb>enable</span> --now docker
</span></span></code></pre></div></li></ul><hr><h3 id=2-é…ç½®-nvidia-container-toolkit-ä»“åº“><strong>2. é…ç½® NVIDIA Container Toolkit ä»“åº“</strong></h3><h3 id=1-æ·»åŠ ä»“åº“å¯†é’¥å’Œæº><strong>(1) æ·»åŠ ä»“åº“å¯†é’¥å’Œæº</strong></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># æ·»åŠ  NVIDIA Container Toolkit çš„ GPG å¯†é’¥</span>
</span></span><span class=line><span class=cl>curl -s -L &lt;https://nvidia.github.io/nvidia-docker/gpgkey&gt; <span class=p>|</span> sudo apt-key add -
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ·»åŠ ä»“åº“æºï¼ˆé€‚ç”¨äº Ubuntu 22.04 &#34;jammy&#34;ï¼‰</span>
</span></span><span class=line><span class=cl><span class=nv>distribution</span><span class=o>=</span><span class=k>$(</span>. /etc/os-release<span class=p>;</span><span class=nb>echo</span> <span class=nv>$ID$VERSION_ID</span><span class=k>)</span>
</span></span><span class=line><span class=cl>curl -s -L &lt;https://nvidia.github.io/nvidia-docker/<span class=nv>$distribution</span>/nvidia-docker.list&gt; <span class=p>|</span> sudo tee /etc/apt/sources.list.d/nvidia-docker.list
</span></span></code></pre></div><h3 id=2-æ›´æ–°åŒ…åˆ—è¡¨><strong>(2) æ›´æ–°åŒ…åˆ—è¡¨</strong></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt-get update
</span></span></code></pre></div><hr><h3 id=3-å®‰è£…-nvidia-container-runtime><strong>3. å®‰è£… NVIDIA Container Runtime</strong></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># å®‰è£… nvidia-container-runtime åŠç›¸å…³å·¥å…·</span>
</span></span><span class=line><span class=cl>sudo apt-get install -y nvidia-container-runtime
</span></span></code></pre></div><hr><h3 id=4-é…ç½®-docker-ä½¿ç”¨-nvidia-è¿è¡Œæ—¶><strong>4. é…ç½® Docker ä½¿ç”¨ NVIDIA è¿è¡Œæ—¶</strong></h3><h3 id=1-ç¼–è¾‘-docker-é…ç½®æ–‡ä»¶><strong>(1) ç¼–è¾‘ Docker é…ç½®æ–‡ä»¶</strong></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nano /etc/docker/daemon.json
</span></span></code></pre></div><h3 id=2-æ·»åŠ ä»¥ä¸‹å†…å®¹><strong>(2) æ·»åŠ ä»¥ä¸‹å†…å®¹</strong></h3><p>è‹¥æ–‡ä»¶ä¸ºç©ºæˆ–å·²æœ‰é…ç½®ï¼Œç¡®ä¿åˆå¹¶ <code>"runtimes"</code> å­—æ®µï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;runtimes&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;nvidia&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;path&#34;</span><span class=p>:</span> <span class=s2>&#34;/usr/bin/nvidia-container-runtime&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;runtimeArgs&#34;</span><span class=p>:</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;default-runtime&#34;</span><span class=p>:</span> <span class=s2>&#34;nvidia&#34;</span>  <span class=err>#</span> <span class=err>å¯é€‰ï¼šè®¾ä¸ºé»˜è®¤è¿è¡Œæ—¶</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=3-ä¿å­˜å¹¶é€€å‡ºç¼–è¾‘å™¨><strong>(3) ä¿å­˜å¹¶é€€å‡ºç¼–è¾‘å™¨</strong></h3><p>æŒ‰ <code>Ctrl+O</code> ä¿å­˜ï¼Œ<code>Ctrl+X</code> é€€å‡ºã€‚</p><h3 id=4-é‡å¯-docker-æœåŠ¡><strong>(4) é‡å¯ Docker æœåŠ¡</strong></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl restart docker
</span></span></code></pre></div><hr><h3 id=5-éªŒè¯å®‰è£…><strong>5. éªŒè¯å®‰è£…</strong></h3><h3 id=1-è¿è¡Œæµ‹è¯•å®¹å™¨><strong>(1) è¿è¡Œæµ‹è¯•å®¹å™¨</strong></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run --rm --gpus all nvidia/cuda:11.8.0-base-ubuntu22.04 nvidia-smi
</span></span></code></pre></div><h3 id=2-é¢„æœŸè¾“å‡º><strong>(2) é¢„æœŸè¾“å‡º</strong></h3><p>åº”æ˜¾ç¤ºä¸å®¿ä¸»æœºç›¸åŒçš„ GPU ä¿¡æ¯ï¼Œç±»ä¼¼ä»¥ä¸‹å†…å®¹ï¼š</p><pre tabindex=0><code>+-----------------------------------------------------------------------------+
| NVIDIA-SMI 535.86.05    Driver Version: 535.86.05    CUDA Version: 12.2     |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|                               |                      |               MIG M. |
|===============================+======================+======================|
|   0  NVIDIA GeForce ...  On   | 00000000:01:00.0 Off |                  N/A |
| N/A   45C    P8    N/A /  N/A |      0MiB /  8192MiB |      0%      Default |
|                               |                      |                  N/A |
+-------------------------------+----------------------+----------------------+
</code></pre><hr><h3 id=6-å¸¸è§é—®é¢˜è§£å†³><strong>6. å¸¸è§é—®é¢˜è§£å†³</strong></h3><h3 id=1-æŠ¥é”™><strong>(1) æŠ¥é”™ &ldquo;Failed to initialize NVML: Driver/library version mismatch&rdquo;</strong></h3><ul><li><strong>åŸå› </strong>ï¼šNVIDIA é©±åŠ¨ç‰ˆæœ¬ä¸å®¹å™¨å†… CUDA ç‰ˆæœ¬ä¸å…¼å®¹ã€‚</li><li><strong>è§£å†³</strong>ï¼šå‡çº§å®¿ä¸»æœº NVIDIA é©±åŠ¨æˆ–ä½¿ç”¨åŒ¹é…çš„ CUDA é•œåƒæ ‡ç­¾ã€‚</li></ul><h3 id=2-æŠ¥é”™><strong>(2) æŠ¥é”™ &ldquo;nvidia-container-runtime not found&rdquo;</strong></h3><ul><li><p><strong>åŸå› </strong>ï¼š<code>nvidia-container-runtime</code> æœªæ­£ç¡®å®‰è£…æˆ–è·¯å¾„é”™è¯¯ã€‚</p></li><li><p><strong>è§£å†³</strong>ï¼šé‡æ–°å®‰è£…å¹¶æ£€æŸ¥è·¯å¾„ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt-get install --reinstall nvidia-container-runtime
</span></span><span class=line><span class=cl>ls -l /usr/bin/nvidia-container-runtime  <span class=c1># ç¡®è®¤æ–‡ä»¶å­˜åœ¨</span>
</span></span></code></pre></div></li></ul><h3 id=3-docker-æœåŠ¡å¯åŠ¨å¤±è´¥><strong>(3) Docker æœåŠ¡å¯åŠ¨å¤±è´¥</strong></h3><ul><li><strong>åŸå› </strong>ï¼š<code>/etc/docker/daemon.json</code> é…ç½®è¯­æ³•é”™è¯¯ã€‚</li><li><strong>è§£å†³</strong>ï¼šä½¿ç”¨ <code>docker info</code> æ£€æŸ¥é”™è¯¯æ—¥å¿—ï¼Œä¿®æ­£ JSON æ ¼å¼ã€‚</li></ul><hr><h3 id=7-æ‰©å±•é…ç½®å¯é€‰><strong>7. æ‰©å±•é…ç½®ï¼ˆå¯é€‰ï¼‰</strong></h3><h3 id=1-é™åˆ¶å®¹å™¨-gpu-è®¿é—®><strong>(1) é™åˆ¶å®¹å™¨ GPU è®¿é—®</strong></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># ä»…å…è®¸ä½¿ç”¨ GPU 0</span>
</span></span><span class=line><span class=cl>docker run --rm --gpus <span class=s1>&#39;&#34;device=0&#34;&#39;</span> nvidia/cuda:11.8.0-base-ubuntu22.04 nvidia-smi
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŒ‡å®šè®¡ç®—èƒ½åŠ›ï¼ˆå¦‚ CUDA 12.0+ï¼‰</span>
</span></span><span class=line><span class=cl>docker run --rm --gpus all --env <span class=nv>NVIDIA_DRIVER_CAPABILITIES</span><span class=o>=</span>compute,utility nvidia/cuda:12.0.0-base-ubuntu22.04 nvidia-smi
</span></span></code></pre></div><h3 id=2-å®‰è£…-nvidia-docker2æ—§ç‰ˆå…¼å®¹><strong>(2) å®‰è£… nvidia-docker2ï¼ˆæ—§ç‰ˆå…¼å®¹ï¼‰</strong></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt-get install -y nvidia-docker2
</span></span><span class=line><span class=cl>sudo systemctl restart docker
</span></span></code></pre></div><hr><h3 id=æ€»ç»“><strong>æ€»ç»“</strong></h3><p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼ŒUbuntu 22.04 ç³»ç»Ÿå·²æˆåŠŸé…ç½® <code>nvidia-container-runtime</code>ï¼Œå…è®¸ Docker å®¹å™¨ç›´æ¥è°ƒç”¨å®¿ä¸»æœºçš„ NVIDIA GPU èµ„æºã€‚å…³é”®ç‚¹åŒ…æ‹¬ï¼š</p><ol><li>æ­£ç¡®é…ç½® NVIDIA ä»“åº“æºã€‚</li><li>å®‰è£… <code>nvidia-container-runtime</code> åŒ…ã€‚</li><li>ä¿®æ”¹ Docker è¿è¡Œæ—¶é…ç½®ã€‚</li><li>éªŒè¯å®¹å™¨å†… GPU è®¿é—®æƒé™ã€‚</li></ol><h2 id=faq>FAQ</h2><p><a href=https://blog.csdn.net/weixin_44966641/article/details/123760614 target=_blank rel="noopener noreffer">docker gpuæŠ¥é”™Error response from daemon: could not select device driver â€œâ€œ with capabilities: [[gpu]]-CSDNåšå®¢</a></p><p>sudo nvidia-ctk runtime configure &ndash;runtime=docker # æ£€æŸ¥</p><h1 id=é•œåƒåŠ é€Ÿ><strong>é•œåƒåŠ é€Ÿ</strong></h1><p><a href=https://www.cnblogs.com/eddyz/p/17168828.html target=_blank rel="noopener noreffer">https://www.cnblogs.com/eddyz/p/17168828.html</a></p><p><a href=https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors target=_blank rel="noopener noreffer">é˜¿é‡Œäº‘ç™»å½• - æ¬¢è¿ç™»å½•é˜¿é‡Œäº‘ï¼Œå®‰å…¨ç¨³å®šçš„äº‘è®¡ç®—æœåŠ¡å¹³å°</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -v https://registry-1.docker.io/v2/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å¯ä»¥é€šè¿‡ä¿®æ”¹daemoné…ç½®æ–‡ä»¶/etc/docker/daemon.jsonæ¥ä½¿ç”¨åŠ é€Ÿå™¨</span>
</span></span><span class=line><span class=cl>sudo mkdir -p /etc/docker
</span></span><span class=line><span class=cl>sudo tee /etc/docker/daemon.json <span class=s>&lt;&lt;-&#39;EOF&#39;
</span></span></span><span class=line><span class=cl><span class=s>{
</span></span></span><span class=line><span class=cl><span class=s>  &#34;registry-mirrors&#34;: [&#34;https://fevvz971.mirror.aliyuncs.com&#34;]
</span></span></span><span class=line><span class=cl><span class=s>  # &#34;registry-mirrors&#34;: [&#34;https://registry.docker-cn.com&#34;, &#34;https://mirror.ccs.tencentyun.com&#34;, &#34;https://docker.mirrors.ustc.edu.cn&#34;]
</span></span></span><span class=line><span class=cl><span class=s>}
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo systemctl daemon-reload
</span></span><span class=line><span class=cl>sudo systemctl restart docker
</span></span></code></pre></div><h3 id=ç¦»çº¿å®‰è£…>ç¦»çº¿å®‰è£…</h3><p><a href=https://www.cnblogs.com/lyjun/p/18393855 target=_blank rel="noopener noreffer">https://www.cnblogs.com/lyjun/p/18393855</a></p><h3 id=é…ç½®æ— æ•ˆé—®é¢˜>é…ç½®æ— æ•ˆé—®é¢˜</h3><p><strong>ä¸€ä¸ªä¸è¡Œæ—¶å¯ä»¥é…ç½®å¤šä¸ªï¼é…ç½®å¤šä¸ªï¼é…ç½®å¤šä¸ªï¼</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;registry-mirrors&#34;</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;https://docker.hpcloud.cloud&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;https://docker.m.daocloud.io&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;https://docker.unsee.tech&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;https://docker.1panel.live&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;http://mirrors.ustc.edu.cn&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;https://docker.chenby.cn&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;http://mirror.azure.cn&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;https://dockerpull.org&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;https://dockerhub.icu&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;https://hub.rat.dev&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;registry-mirrors&#34;</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;https://docker.registry.cyou&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;https://docker-cf.registry.cyou&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;https://dockercf.jsdelivr.fyi&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;https://docker.jsdelivr.fyi&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;https://dockertest.jsdelivr.fyi&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;https://mirror.aliyuncs.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;https://dockerproxy.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;https://mirror.baidubce.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;https://docker.m.daocloud.io&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;https://docker.nju.edu.cn&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;https://docker.mirrors.sjtug.sjtu.edu.cn&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;https://docker.mirrors.ustc.edu.cn&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;https://mirror.iscas.ac.cn&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;https://docker.rainbond.cc&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span></code></pre></div><h1 id=å¤šä¸ªç›®å½•æ˜ å°„>å¤šä¸ªç›®å½•æ˜ å°„</h1><p>åœ¨ Docker ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>-v</code> æˆ– <code>--volume</code> é€‰é¡¹æ¥æŒ‚è½½å¤šä¸ªç›®å½•åˆ°å®¹å™¨ä¸­ã€‚ä¸‹é¢æ˜¯ä¸€äº›ç¤ºä¾‹ï¼š</p><h3 id=ä½¿ç”¨-v-é€‰é¡¹æŒ‚è½½å¤šä¸ªç›®å½•>ä½¿ç”¨ <code>v</code> é€‰é¡¹æŒ‚è½½å¤šä¸ªç›®å½•ï¼š</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -v /host/path1:/container/path1 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -v /host/path2:/container/path2 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -v /host/path3:/container/path3 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --name my_container <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  my_image
</span></span></code></pre></div><h1 id=ä¿®æ”¹å®¹å™¨å†…apté•œåƒæº>ä¿®æ”¹å®¹å™¨å†…apté•œåƒæº</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cp /etc/apt/sources.list /etc/apt/sources.list.bak
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;&#34;</span> &gt; /etc/apt/sources.list
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;deb http://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse
</span></span></span><span class=line><span class=cl><span class=s2>deb http://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse
</span></span></span><span class=line><span class=cl><span class=s2>deb http://mirrors.aliyun.com/ubuntu/ jammy-security main restricted universe multiverse
</span></span></span><span class=line><span class=cl><span class=s2>deb http://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse
</span></span></span><span class=line><span class=cl><span class=s2>deb http://mirrors.aliyun.com/ubuntu/ jammy-proposed main restricted universe multiverse&#34;</span> &gt; /etc/apt/sources.list
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>apt update
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Ubuntu ç‰ˆæœ¬ä»£å·ï¼š
</span></span><span class=line><span class=cl>ç‰ˆæœ¬	ä»£å·
</span></span><span class=line><span class=cl>Ubuntu 24.04	noble
</span></span><span class=line><span class=cl>Ubuntu 22.04	jammy
</span></span><span class=line><span class=cl>Ubuntu 20.04	focal
</span></span><span class=line><span class=cl>Ubuntu 18.04	bionic
</span></span><span class=line><span class=cl>Ubuntu 16.04	xenial
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>å¦‚æœä½ çš„ Ubuntu ç‰ˆæœ¬ä¸åŒï¼Œä¿®æ”¹ sources.list é‡Œçš„ jammy ä¸ºå¯¹åº”çš„ä»£å·ã€‚
</span></span><span class=line><span class=cl><span class=c1># Ubuntu 20.04	focal</span>
</span></span><span class=line><span class=cl>deb http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse
</span></span><span class=line><span class=cl>deb http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse
</span></span><span class=line><span class=cl>deb http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse
</span></span></code></pre></div><h1 id=å®¹å™¨id>å®¹å™¨id</h1><p>åœ¨ Docker å®¹å™¨å†…æŸ¥çœ‹å®¹å™¨çš„ IDï¼Œä½ å¯ä»¥åœ¨å®¹å™¨çš„ç»ˆç«¯ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><p>bash</p><p>cat /proc/self/cgroup | grep &lsquo;docker&rsquo; | sed &rsquo;s/.*///&rsquo; | tail -n1</p><p>è¿™ä¸ªå‘½ä»¤å°†è¾“å‡ºå½“å‰å®¹å™¨çš„ IDã€‚è¯·æ³¨æ„ï¼Œè¿™ä¸ªæ–¹æ³•å‡è®¾ä½ çš„å®¹å™¨è¿è¡Œåœ¨ Docker ä¸­ï¼Œå¹¶ä¸”å®¹å™¨å†…æœ‰ /proc/self/cgroup æ–‡ä»¶ã€‚</p><p>å¦‚æœä½ æ˜¯åœ¨äº¤äº’å¼ç»ˆç«¯ä¸­è¿è¡Œå®¹å™¨ï¼Œå¹¶ä¸”çŸ¥é“ä½ æ­£åœ¨æŸ¥çœ‹çš„å®¹å™¨æ˜¯ä»€ä¹ˆï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰å®¹å™¨çš„ IDï¼š</p><p>bash</p><p>hostname</p><p>è¿™ä¼šè¾“å‡ºå®¹å™¨çš„ä¸»æœºåï¼Œé€šå¸¸æ˜¯å®¹å™¨çš„çŸ­ IDã€‚è¯·æ³¨æ„ï¼Œè¿™ä¸æ˜¯å®¹å™¨çš„å®Œæ•´ IDï¼Œä½†åœ¨äº¤äº’å¼ç»ˆç«¯ä¸­ï¼Œé€šå¸¸è¶³å¤Ÿè¯†åˆ«å®¹å™¨ã€‚</p><h1 id=è¿ç§»å¯¼å‡º>è¿ç§»å¯¼å‡º</h1><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># é•œåƒè¿ç§»</span>
</span></span><span class=line><span class=cl>docker save é•œåƒå:æ ‡ç­¾ &gt; é•œåƒ.tar
</span></span><span class=line><span class=cl>scp é•œåƒ.tar newserver:/tmp/
</span></span><span class=line><span class=cl>docker load &lt; /tmp/é•œåƒ.tar
</span></span></code></pre></div><h3 id=å®¹å™¨è¿ç§»å¦‚æœéœ€è¦ä¿ç•™è¿è¡ŒçŠ¶æ€æŒ‚è½½>å®¹å™¨è¿ç§»ï¼ˆå¦‚æœéœ€è¦ä¿ç•™è¿è¡ŒçŠ¶æ€ã€æŒ‚è½½ï¼‰</h3><p>æœ€å¥½æŠŠå®¹å™¨æ•°æ®ï¼ˆvolumeï¼‰ä¹Ÿä¸€èµ·è¿ç§»ã€‚</p><ul><li>ä¿å­˜ volume ç›®å½•</li><li>docker-compose é…ç½®æ–‡ä»¶å¤‡ä»½</li><li>ä¹Ÿå¯ä»¥ç”¨ <code>docker export</code> å’Œ <code>docker import</code>ï¼Œä½†é‚£æ ·ä¼šä¸¢å¤± volume æŒ‚è½½ä¿¡æ¯ã€‚</li></ul><h1 id=é…ç½®ä»£ç†>é…ç½®ä»£ç†</h1><p>åœ¨ä½¿ç”¨ Docker æ—¶ï¼Œç”±äºç½‘ç»œé™åˆ¶ï¼Œæœ‰æ—¶éœ€è¦è®¾ç½®ä»£ç†æ‰èƒ½æ­£å¸¸æ‹‰å–é•œåƒã€æ¨é€é•œåƒç­‰æ“ä½œã€‚ä¸‹é¢å°†åˆ†åˆ«ä»‹ç»åœ¨ Linuxã€Windows å’Œ macOS ç³»ç»Ÿä¸­ä¸º Docker è®¾ç½®ä»£ç†çš„æ–¹æ³•ã€‚</p><h3 id=linux-ç³»ç»Ÿ>Linux ç³»ç»Ÿ</h3><h3 id=ç³»ç»Ÿçº§ä»£ç†é…ç½®>ç³»ç»Ÿçº§ä»£ç†é…ç½®</h3><p>å¦‚æœä½ å¸Œæœ› Docker æœåŠ¡åœ¨ç³»ç»Ÿå±‚é¢ä½¿ç”¨ä»£ç†ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤è¿›è¡Œé…ç½®ï¼š</p><ol><li><strong>åˆ›å»ºæˆ–ç¼–è¾‘ Docker æœåŠ¡é…ç½®ç›®å½•</strong>
åœ¨ <code>/etc/systemd/system/docker.service.d</code> ç›®å½•ä¸‹åˆ›å»ºæˆ–ç¼–è¾‘ <code>http-proxy.conf</code> æ–‡ä»¶ï¼Œå¦‚æœè¯¥ç›®å½•ä¸å­˜åœ¨ï¼Œå¯ä»¥æ‰‹åŠ¨åˆ›å»ºã€‚</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo mkdir -p /etc/systemd/system/docker.service.d
</span></span><span class=line><span class=cl>sudo vim /etc/systemd/system/docker.service.d/http-proxy.conf
</span></span></code></pre></div><ol><li><strong>æ·»åŠ ä»£ç†é…ç½®</strong>
åœ¨ <code>http-proxy.conf</code> æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œå°† <code>your-proxy-server</code> å’Œ <code>your-proxy-port</code> æ›¿æ¢ä¸ºå®é™…çš„ä»£ç†æœåŠ¡å™¨åœ°å€å’Œç«¯å£ã€‚</li></ol><pre tabindex=0><code># æ³¨é‡Šæ‰å³ä¸ºåˆ é™¤
[Service]
Environment=&#34;HTTP_PROXY=http://your-proxy-server:your-proxy-port/&#34;
Environment=&#34;HTTPS_PROXY=http://your-proxy-server:your-proxy-port/&#34;
Environment=&#34;NO_PROXY=localhost,127.0.0.1,.example.com&#34;
</code></pre><p>å…¶ä¸­ï¼Œ<code>NO_PROXY</code> ç”¨äºæŒ‡å®šä¸éœ€è¦ä½¿ç”¨ä»£ç†çš„åœ°å€ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹ã€‚</p><ol><li><strong>é‡æ–°åŠ è½½ systemd ç®¡ç†å™¨é…ç½®å¹¶é‡å¯ Docker æœåŠ¡</strong></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl daemon-reload
</span></span><span class=line><span class=cl>sudo systemctl restart docker
</span></span></code></pre></div><h3 id=å®¹å™¨çº§ä»£ç†é…ç½®>å®¹å™¨çº§ä»£ç†é…ç½®</h3><p>å¦‚æœä½ åªæƒ³ä¸ºç‰¹å®šçš„å®¹å™¨è®¾ç½®ä»£ç†ï¼Œå¯ä»¥åœ¨è¿è¡Œå®¹å™¨æ—¶é€šè¿‡ç¯å¢ƒå˜é‡æŒ‡å®šä»£ç†ã€‚ä¾‹å¦‚ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -e <span class=nv>HTTP_PROXY</span><span class=o>=</span>http://your-proxy-server:your-proxy-port <span class=se>\\</span>
</span></span><span class=line><span class=cl>           -e <span class=nv>HTTPS_PROXY</span><span class=o>=</span>http://your-proxy-server:your-proxy-port <span class=se>\\</span>
</span></span><span class=line><span class=cl>           -e <span class=nv>NO_PROXY</span><span class=o>=</span>localhost,127.0.0.1,.example.com <span class=se>\\</span>
</span></span><span class=line><span class=cl>           your-image
</span></span></code></pre></div><h3 id=windows-ç³»ç»Ÿ>Windows ç³»ç»Ÿ</h3><h3 id=docker-desktop-é…ç½®>Docker Desktop é…ç½®</h3><p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Docker Desktop for Windowsï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è®¾ç½®ä»£ç†ï¼š</p><ol><li><strong>æ‰“å¼€ Docker Desktop è®¾ç½®</strong>
å³é”®å•å‡»ç³»ç»Ÿæ‰˜ç›˜ä¸­çš„ Docker å›¾æ ‡ï¼Œé€‰æ‹©â€œSettingsâ€ã€‚</li><li><strong>é…ç½®ä»£ç†</strong>
åœ¨å·¦ä¾§èœå•ä¸­é€‰æ‹©â€œProxiesâ€ï¼Œå‹¾é€‰â€œManual proxy configurationâ€ï¼Œç„¶ååˆ†åˆ«å¡«å†™ HTTP å’Œ HTTPS ä»£ç†æœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£ã€‚å¦‚æœæœ‰ä¸éœ€è¦ä½¿ç”¨ä»£ç†çš„åœ°å€ï¼Œå¯ä»¥åœ¨â€œExceptionsâ€å­—æ®µä¸­å¡«å†™ã€‚</li><li><strong>åº”ç”¨é…ç½®</strong>
ç‚¹å‡»â€œApply & Restartâ€æŒ‰é’®ï¼Œä½¿é…ç½®ç”Ÿæ•ˆã€‚</li></ol><h3 id=macos-ç³»ç»Ÿ>macOS ç³»ç»Ÿ</h3><h3 id=docker-desktop-é…ç½®-1>Docker Desktop é…ç½®</h3><p>ä¸ Windows ç³»ç»Ÿç±»ä¼¼ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Docker Desktop for Macï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è®¾ç½®ä»£ç†ï¼š</p><ol><li><strong>æ‰“å¼€ Docker Desktop è®¾ç½®</strong>
ç‚¹å‡»èœå•æ ä¸­çš„ Docker å›¾æ ‡ï¼Œé€‰æ‹©â€œPreferencesâ€ã€‚</li><li><strong>é…ç½®ä»£ç†</strong>
åœ¨å·¦ä¾§èœå•ä¸­é€‰æ‹©â€œProxiesâ€ï¼Œå‹¾é€‰â€œManual proxy configurationâ€ï¼Œç„¶ååˆ†åˆ«å¡«å†™ HTTP å’Œ HTTPS ä»£ç†æœåŠ¡å™¨çš„åœ°å€å’Œç«¯å£ã€‚å¦‚æœæœ‰ä¸éœ€è¦ä½¿ç”¨ä»£ç†çš„åœ°å€ï¼Œå¯ä»¥åœ¨â€œExceptionsâ€å­—æ®µä¸­å¡«å†™ã€‚</li><li><strong>åº”ç”¨é…ç½®</strong>
ç‚¹å‡»â€œApply & Restartâ€æŒ‰é’®ï¼Œä½¿é…ç½®ç”Ÿæ•ˆã€‚</li></ol><p>é€šè¿‡ä»¥ä¸Šæ–¹æ³•ï¼Œä½ å¯ä»¥åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸­ä¸º Docker è®¾ç½®ä»£ç†ï¼Œç¡®ä¿ Docker èƒ½å¤Ÿæ­£å¸¸è®¿é—®ç½‘ç»œèµ„æºã€‚</p><h1 id=faq-1>FAQ</h1><h2 id=ä¸´æ—¶æå‡æƒé™æ“ä½œæ–‡ä»¶>ä¸´æ—¶æå‡æƒé™æ“ä½œæ–‡ä»¶</h2><p>åœ¨ Linux ä¸­ï¼Œå¦‚æœä½ æ‹¥æœ‰ <strong>Docker çš„ root æƒé™</strong>ï¼ˆå³ä½ èƒ½æ‰§è¡Œ <code>docker</code> å‘½ä»¤è€Œä¸åŠ  <code>sudo</code>ï¼‰ï¼Œä½ å°±å¯ä»¥ <strong>é€šè¿‡å®¹å™¨æŒ‚è½½å¹¶ä¿®æ”¹ä»»æ„å®¿ä¸»æœºç›®å½•çš„æƒé™å’Œå†…å®¹</strong>ã€‚è¿™æ˜¯ä¸€ç§å¼ºå¤§çš„åŠŸèƒ½ï¼Œä½†ä¹Ÿéå¸¸æ•æ„Ÿï¼Œå®¹æ˜“è¯¯æ“ä½œç ´åç³»ç»Ÿå®‰å…¨ã€‚</p><hr><h2 id=-å®ç°æ­¥éª¤æœ‰-root-æƒé™å‰æ>âœ… å®ç°æ­¥éª¤ï¼ˆæœ‰ root æƒé™å‰æï¼‰</h2><h3 id=-åœºæ™¯ç›®æ ‡>ğŸ§± åœºæ™¯ç›®æ ‡ï¼š</h3><p>å°†å®¿ä¸»æœºä»»æ„ç›®å½•ï¼ˆæ¯”å¦‚ <code>/etc/ssh</code>ï¼‰æŒ‚è½½åˆ° Docker å®¹å™¨ï¼Œå¹¶åœ¨å®¹å™¨å†…è‡ªç”±ä¿®æ”¹æƒé™/å†…å®¹ã€‚</p><hr><h2 id=-å‰ææ¡ä»¶>ğŸ” å‰ææ¡ä»¶</h2><ul><li><p>ä½ æ˜¯ docker ç»„æˆå‘˜ï¼ˆæˆ–ä»¥ root èº«ä»½è¿è¡Œ <code>docker</code> å‘½ä»¤ï¼‰ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>groups <span class=nv>$USER</span> <span class=p>|</span> grep docker
</span></span></code></pre></div><p>å¦‚æœæ²¡æœ‰æƒé™ï¼Œå¯ç”¨ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo usermod -aG docker <span class=nv>$USER</span> <span class=o>&amp;&amp;</span> newgrp docker
</span></span></code></pre></div></li></ul><hr><h2 id=-ç¤ºä¾‹æŒ‚è½½å®¿ä¸»æœºä»»æ„ç›®å½•å¹¶ä¿®æ”¹æƒé™>ğŸ§ª ç¤ºä¾‹ï¼šæŒ‚è½½å®¿ä¸»æœºä»»æ„ç›®å½•å¹¶ä¿®æ”¹æƒé™</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -it --rm <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -v /etc/ssh:/mnt/ssh <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --privileged <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  ubuntu bash
</span></span></code></pre></div><p>è§£é‡Šï¼š</p><ul><li><code>v /etc/ssh:/mnt/ssh</code>ï¼šæŠŠå®¿ä¸»æœº <code>/etc/ssh</code> æŒ‚è½½è¿›å®¹å™¨</li><li><code>-privileged</code>ï¼šè®©å®¹å™¨å†…å¯ä»¥ä½¿ç”¨å…¨éƒ¨ Linux åŠŸèƒ½ï¼ˆå¦‚ <code>chown</code>, <code>chmod</code>, <code>mount</code> ç­‰ï¼‰</li><li><code>ubuntu bash</code>ï¼šä½¿ç”¨ Ubuntu é•œåƒå¯åŠ¨ Bash äº¤äº’</li></ul><p>ç„¶åä½ å¯ä»¥åœ¨å®¹å™¨ä¸­æ‰§è¡Œï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /mnt/ssh
</span></span><span class=line><span class=cl>chmod <span class=m>777</span> sshd_config
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;# hacked!&#34;</span> &gt;&gt; sshd_config
</span></span></code></pre></div><p>è¿™äº›æ›´æ”¹ä¼š<strong>ç›´æ¥åæ˜ åœ¨å®¿ä¸»æœº <code>/etc/ssh/sshd_config</code></strong> ä¸Šã€‚</p><hr><h2 id=-ä¿®æ”¹ä»»æ„ç›®å½•æƒé™çš„æŠ€å·§å¸¸ç”¨>ğŸ› ï¸ ä¿®æ”¹ä»»æ„ç›®å½•æƒé™çš„æŠ€å·§ï¼ˆå¸¸ç”¨ï¼‰</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -it --rm <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -v /opt/data:/mnt/data <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --entrypoint bash <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --user root <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  ubuntu
</span></span></code></pre></div><p>åœ¨å®¹å™¨å†…æ‰§è¡Œï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>chmod -R <span class=m>777</span> /mnt/data
</span></span><span class=line><span class=cl>chown -R someuser:somegroup /mnt/data
</span></span></code></pre></div><hr><h2 id=-é£é™©æé†’>âš ï¸ é£é™©æé†’</h2><table><thead><tr><th>é¡¹ç›®</th><th>é£é™©è¯´æ˜</th></tr></thead><tbody><tr><td>æƒé™è¿‡å¤§</td><td>å¯ä»¥ç ´åç³»ç»Ÿé…ç½®ï¼Œä¾‹å¦‚è¯¯åˆ  <code>/etc/passwd</code></td></tr><tr><td>å®¹å™¨ææƒ</td><td><code>--privileged</code> ç»™äºˆ root æƒé™ï¼Œç›¸å½“äºâ€œè£¸å¥”â€</td></tr><tr><td>å®‰å…¨å»ºè®®</td><td><strong>ç”Ÿäº§ç¯å¢ƒç¦æ­¢ä½¿ç”¨</strong> <code>--privileged</code> å’ŒæŒ‚è½½ç³»ç»Ÿç›®å½•</td></tr></tbody></table><hr><h2 id=-æ¨èæ›¿ä»£æ–¹æ¡ˆå®‰å…¨åšæ³•>âœ… æ¨èæ›¿ä»£æ–¹æ¡ˆï¼ˆå®‰å…¨åšæ³•ï¼‰</h2><p>å¦‚æœåªæ˜¯æƒ³<strong>æŒ‚è½½å¹¶è¯»å†™æŸä¸ªæ•°æ®ç›®å½•</strong>ï¼ˆå¦‚ <code>/data/projects</code>ï¼‰ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -it --rm <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -v /data/projects:/mnt/projects <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  ubuntu bash
</span></span></code></pre></div><p>é…åˆå®¿ä¸»æœºæå‰è®¾å®šå¥½æƒé™å³å¯ï¼Œä¸éœ€è¦ <code>--privileged</code>ã€‚</p><hr><h2 id=-æ€»ç»“ä¸€å¥è¯>ğŸ¯ æ€»ç»“ä¸€å¥è¯ï¼š</h2><blockquote><p>æœ‰ Docker root æƒé™ï¼Œå°±èƒ½ç”¨å®¹å™¨æŒ‚è½½ä»»æ„ç›®å½•å¹¶ç”¨ root æƒé™åœ¨å…¶ä¸­è‡ªç”±æ”¹æƒé™ã€åˆ æ–‡ä»¶ã€åŠ æ•°æ® â€”â€” éå¸¸å¼ºå¤§ä¹Ÿè¦æ ¼å¤–å°å¿ƒï¼</p></blockquote><hr><p>æ˜¯å¦éœ€è¦æˆ‘å¸®ä½ å†™ä¸€ä¸ªè„šæœ¬æ¨¡æ¿ï¼Œæ¯”å¦‚è‡ªåŠ¨æŒ‚è½½æŸç›®å½•å¹¶ä¿®æƒé™ï¼Ÿ</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•å®ç”¨çš„ <strong>Docker è‡ªåŠ¨æŒ‚è½½ç›®å½•å¹¶ä¿®æƒé™çš„è„šæœ¬æ¨¡æ¿</strong>ï¼Œé€‚ç”¨äºä½ æƒ³ç”¨å®¹å™¨ <strong>è‡ªåŠ¨ä¿®å¤å®¿ä¸»æœºæŸä¸ªç›®å½•çš„æƒé™</strong> çš„æƒ…å†µã€‚</p><hr><h2 id=-è„šæœ¬fix-permssh>âœ… è„šæœ¬ï¼š<code>fix-perms.sh</code></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1># è¦æŒ‚è½½å¹¶ä¿®æ”¹æƒé™çš„å®¿ä¸»æœºç›®å½•</span>
</span></span><span class=line><span class=cl><span class=nv>HOST_DIR</span><span class=o>=</span><span class=s2>&#34;/data/myproject&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># å®¹å™¨ä¸­æ˜ å°„è·¯å¾„</span>
</span></span><span class=line><span class=cl><span class=nv>CONTAINER_DIR</span><span class=o>=</span><span class=s2>&#34;/mnt/target&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç›®æ ‡æƒé™</span>
</span></span><span class=line><span class=cl><span class=nv>PERM_MODE</span><span class=o>=</span><span class=s2>&#34;755&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç›®æ ‡ç”¨æˆ·å’Œç”¨æˆ·ç»„ï¼ˆå¯é€‰ï¼‰</span>
</span></span><span class=line><span class=cl><span class=nv>OWNER</span><span class=o>=</span><span class=s2>&#34;root:root&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ä½¿ç”¨ Ubuntu é•œåƒï¼Œå®¹å™¨è‡ªåŠ¨é€€å‡º</span>
</span></span><span class=line><span class=cl>docker run --rm <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -v <span class=s2>&#34;</span><span class=si>${</span><span class=nv>HOST_DIR</span><span class=si>}</span><span class=s2>:</span><span class=si>${</span><span class=nv>CONTAINER_DIR</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --user root <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --entrypoint bash <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  ubuntu <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  -c <span class=s2>&#34;chown -R </span><span class=si>${</span><span class=nv>OWNER</span><span class=si>}</span><span class=s2> </span><span class=si>${</span><span class=nv>CONTAINER_DIR</span><span class=si>}</span><span class=s2> &amp;&amp; chmod -R </span><span class=si>${</span><span class=nv>PERM_MODE</span><span class=si>}</span><span class=s2> </span><span class=si>${</span><span class=nv>CONTAINER_DIR</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span></code></pre></div><hr><h2 id=-ç”¨æ³•>ğŸ”§ ç”¨æ³•</h2><ol><li><p>å¤åˆ¶ä¸Šè¿°è„šæœ¬ä¿å­˜ä¸º <code>fix-perms.sh</code></p></li><li><p>èµ‹äºˆæ‰§è¡Œæƒé™ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>chmod +x fix-perms.sh
</span></span></code></pre></div></li><li><p>æ‰§è¡Œè„šæœ¬ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./fix-perms.sh
</span></span></code></pre></div></li></ol><hr><h2 id=-å¯é€‰å¢å¼ºåŠŸèƒ½>ğŸ“Œ å¯é€‰å¢å¼ºåŠŸèƒ½</h2><ul><li>æ”¯æŒå‘½ä»¤è¡Œå‚æ•°ï¼š<code>./fix-perms.sh /some/dir 777 user:group</code></li><li>è®¾å®šé»˜è®¤é•œåƒæˆ–åˆ‡æ¢ä¸º Alpine ä»¥ç¼©å°ä½“ç§¯</li><li>ä½¿ç”¨ <code>-privileged</code> è‹¥ä½ ä¿®æ”¹çš„ç›®å½•æƒé™å—é™åˆ¶ï¼ˆå¦‚ <code>/etc</code>ï¼‰</li></ul><hr><h2 id=-æ³¨æ„äº‹é¡¹>ğŸš¨ æ³¨æ„äº‹é¡¹</h2><ul><li>è„šæœ¬å¯¹å®¿ä¸»ç›®å½•æœ‰<strong>çœŸå®å½±å“</strong>ï¼ŒåŠ¡å¿…å°å¿ƒæ“ä½œã€‚</li><li>å¦‚æœè¦åå¤ç”¨ï¼Œå¯æ·»åŠ æ—¥å¿—è¾“å‡ºã€‚</li></ul><hr><p>æ˜¯å¦éœ€è¦æˆ‘å¸®ä½ æ”¹é€ æˆæ”¯æŒå¤šä¸ªç›®å½•æˆ–è€…å‚æ•°è¾“å…¥çš„å¢å¼ºç‰ˆï¼Ÿ</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2025-04-29</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://fjyu95.github.io/posts/docker-199e4020f06080f09e9cd8f239bcf9e7/ data-title=docker data-hashtags=docker><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://fjyu95.github.io/posts/docker-199e4020f06080f09e9cd8f239bcf9e7/ data-hashtag=docker><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://fjyu95.github.io/posts/docker-199e4020f06080f09e9cd8f239bcf9e7/ data-title=docker><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://fjyu95.github.io/posts/docker-199e4020f06080f09e9cd8f239bcf9e7/ data-title=docker><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on å¾®åš" data-sharer=weibo data-url=https://fjyu95.github.io/posts/docker-199e4020f06080f09e9cd8f239bcf9e7/ data-title=docker><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/docker/>Docker</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/linux-command-de039fc517af4e2bb44d03ac1dc38fc3/ class=prev rel=prev title="Linux command"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Linux command</a>
<a href=/posts/git-bash-6e38abb2523440e89cbd0524226ca63a/ class=next rel=next title=Git>Git<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.145.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.3.0"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2020 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://fjyu95.github.io/ target=_blank>fjyu95</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>